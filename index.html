<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŒåä¸€å›¢é˜Ÿä¸šç»©æ’è¡Œæ¦œ</title>
  
  <!-- å¼•å…¥å¤–éƒ¨èµ„æº -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
  
  <!-- Tailwind é…ç½® -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            primary: '#FF4D4F',
            secondary: '#FAAD14',
            success: '#52C41A',
            neutral: {
              100: '#F7F8FA',
              200: '#F2F3F5',
              300: '#E5E6EB',
              400: '#C9CDD4',
              500: '#86909C',
              600: '#4E5969',
              700: '#272E3B',
              800: '#1D2129',
            }
          },
          fontFamily: {
            inter: ['Inter', 'system-ui', 'sans-serif'],
          },
          animation: {
            'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
            'bounce-slow': 'bounce 2s infinite',
            'fadeIn': 'fadeIn 0.5s ease-in',
            'slideUp': 'slideUp 0.5s ease-out',
          },
          keyframes: {
            fadeIn: {
              '0%': { opacity: '0' },
              '100%': { opacity: '1' },
            },
            slideUp: {
              '0%': { transform: 'translateY(20px)', opacity: '0' },
              '100%': { transform: 'translateY(0)', opacity: '1' },
            }
          }
        },
      }
    }
  </script>
  
  <!-- è‡ªå®šä¹‰æ ·å¼ -->
  <style type="text/tailwindcss">
    @layer utilities {
      .card-hover {
        @apply transition-all duration-300 hover:shadow-xl hover:-translate-y-1;
      }
      .rank-up {
        @apply text-success animate-pulse-slow;
      }
      .rank-down {
        @apply text-primary animate-pulse-slow;
      }
      .progress-bar {
        @apply h-2 rounded-full overflow-hidden bg-neutral-200;
      }
      .progress-value {
        @apply h-full transition-all duration-1000 ease-out rounded-full;
      }
      .btn-primary {
        @apply bg-primary hover:bg-primary/90 text-white px-4 py-2 rounded-lg transition-all duration-200 shadow-sm hover:shadow-md;
      }
      .btn-secondary {
        @apply bg-neutral-100 hover:bg-neutral-200 text-neutral-700 px-4 py-2 rounded-lg transition-all duration-200;
      }
      .input-field {
        @apply w-full px-3 py-2 border border-neutral-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all;
      }
    }
  </style>
  
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
    
    body {
      font-family: 'Inter', system-ui, sans-serif;
      scroll-behavior: smooth;
    }
    
    /* ä¼˜åŒ–çš„æ•°å­—æ»šåŠ¨åŠ¨ç”» */
    .number-scroll {
      transition: all 0.8s cubic-bezier(0.25, 0.46, 0.45, 0.94);
    }
    
    /* æ’è¡Œæ¦œé¡¹åŠ¨ç”» */
    .rank-item {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    
    .rank-item:hover {
      transform: translateX(4px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    }
    
    /* åŠ è½½åŠ¨ç”» */
    .loader {
      border-top-color: #FF4D4F;
      animation: spinner 0.6s linear infinite;
    }
    
    @keyframes spinner {
      to { transform: rotate(360deg); }
    }
    
    /* å‰ä¸‰åå¥–ç‰Œæ•ˆæœ */
    .medal-shine {
      position: relative;
      overflow: hidden;
    }
    
    .medal-shine::after {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: linear-gradient(
        45deg,
        transparent 30%,
        rgba(255, 255, 255, 0.3) 50%,
        transparent 70%
      );
      animation: shine 3s infinite;
    }
    
    @keyframes shine {
      0%, 100% { transform: translateX(-100%) translateY(-100%) rotate(45deg); }
      50% { transform: translateX(100%) translateY(100%) rotate(45deg); }
    }
    
    /* æ»šåŠ¨æ¡æ ·å¼ */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #a8a8a8;
    }
    
    /* éª¨æ¶å±åŠ¨ç”» */
    @keyframes skeleton-loading {
      0% { background-position: -200px 0; }
      100% { background-position: calc(200px + 100%) 0; }
    }
    
    .skeleton {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200px 100%;
      animation: skeleton-loading 1.5s infinite;
    }
    
    /* ä¼˜åŒ–ç§»åŠ¨ç«¯è§¦æ‘¸åé¦ˆ */
    @media (hover: none) {
      .card-hover:active {
        transform: scale(0.98);
      }
      
      .rank-item:active {
        background-color: #f5f5f5;
      }
    }
  </style>
</head>

<body class="bg-neutral-100 text-neutral-800 min-h-screen flex flex-col">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  - ä¼˜åŒ–å“åº”å¼å¸ƒå±€ -->
  <header class="bg-white shadow-md sticky top-0 z-50 transition-all duration-300">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-3">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-3">
        <!-- æ ‡é¢˜å’ŒLogo -->
        <div class="flex items-center space-x-2 sm:space-x-3">
          <div class="bg-primary text-white p-2 rounded-lg shadow-sm">
            <i class="fa fa-line-chart text-xl sm:text-2xl"></i>
          </div>
          <h1 class="text-lg sm:text-xl md:text-2xl font-bold text-neutral-800">
            å¥¹è¯­åŒåä¸€<span class="text-primary">å›¢é˜Ÿç›®æ ‡å®Œæˆç‡</span>æ’è¡Œæ¦œ
          </h1>
        </div>
        
        <!-- æ“ä½œæŒ‰é’®ç»„ - ä¼˜åŒ–ç§»åŠ¨ç«¯å¸ƒå±€ -->
        <div class="flex items-center gap-2 sm:gap-3">
          <button id="refreshBtn" class="btn-secondary p-2 sm:p-2.5" title="åˆ·æ–°æ•°æ®">
            <i class="fa fa-refresh text-neutral-600"></i>
          </button>
          
          <button id="themeToggle" class="btn-secondary p-2 sm:p-2.5 hidden sm:block" title="åˆ‡æ¢ä¸»é¢˜">
            <i class="fa fa-moon-o text-neutral-600"></i>
          </button>
          
          <button id="adminToggle" class="btn-primary text-sm flex items-center gap-1.5">
            <i class="fa fa-cog"></i>
            <span class="hidden sm:inline">ç®¡ç†</span>
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- ä¸»å†…å®¹åŒº -->
  <main class="flex-grow container mx-auto px-4 sm:px-6 lg:px-8 py-4 sm:py-6">
    <!-- é¡¶éƒ¨ç»Ÿè®¡å¡ç‰‡ - ä¼˜åŒ–å“åº”å¼ -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6 mb-6 sm:mb-8">
      <!-- å€’è®¡æ—¶å¡ç‰‡ -->
      <div class="bg-gradient-to-r from-primary/90 to-primary rounded-xl shadow-lg p-5 sm:p-6 text-white card-hover animate-fadeIn">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <h3 class="text-white/90 text-xs sm:text-sm font-medium mb-2">æ´»åŠ¨å‰©ä½™æ—¶é—´</h3>
            <div class="flex gap-2 sm:gap-3 mt-3" id="countdown">
              <div class="bg-white/20 backdrop-blur-sm rounded-lg w-12 h-12 sm:w-14 sm:h-14 flex flex-col items-center justify-center">
                <span class="text-xl sm:text-2xl font-bold" id="days">05</span>
                <span class="text-xs">å¤©</span>
              </div>
              <div class="bg-white/20 backdrop-blur-sm rounded-lg w-12 h-12 sm:w-14 sm:h-14 flex flex-col items-center justify-center">
                <span class="text-xl sm:text-2xl font-bold" id="hours">18</span>
                <span class="text-xs">æ—¶</span>
              </div>
              <div class="bg-white/20 backdrop-blur-sm rounded-lg w-12 h-12 sm:w-14 sm:h-14 flex flex-col items-center justify-center">
                <span class="text-xl sm:text-2xl font-bold" id="minutes">45</span>
                <span class="text-xs">åˆ†</span>
              </div>
              <div class="bg-white/20 backdrop-blur-sm rounded-lg w-12 h-12 sm:w-14 sm:h-14 flex flex-col items-center justify-center">
                <span class="text-xl sm:text-2xl font-bold" id="seconds">33</span>
                <span class="text-xs">ç§’</span>
              </div>
            </div>
          </div>
          <div class="bg-white/20 p-2.5 sm:p-3 rounded-full">
            <i class="fa fa-clock-o text-xl sm:text-2xl"></i>
          </div>
        </div>
      </div>
      
      <!-- è¾¾æˆç‡å¡ç‰‡ -->
      <div class="bg-white rounded-xl shadow-md p-5 sm:p-6 card-hover animate-fadeIn" style="animation-delay: 0.1s">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <h3 class="text-neutral-500 text-xs sm:text-sm font-medium mb-1">æ€»ä½“ç›®æ ‡è¾¾æˆç‡</h3>
            <div class="flex items-end gap-2 mt-2">
              <span class="text-2xl sm:text-3xl font-bold number-scroll" id="overallRate">67.8</span>
              <span class="text-neutral-600 text-sm mb-1">%</span>
            </div>
            <div class="mt-3 w-full progress-bar">
              <div class="progress-value bg-gradient-to-r from-primary to-primary/80" id="overallProgressBar" style="width: 67.8%"></div>
            </div>
          </div>
          <div class="bg-primary/10 p-2.5 sm:p-3 rounded-full text-primary">
            <i class="fa fa-tasks text-xl sm:text-2xl"></i>
          </div>
        </div>
      </div>
      
      <!-- å›¢é˜Ÿæ•°é‡å¡ç‰‡ -->
      <div class="bg-white rounded-xl shadow-md p-5 sm:p-6 card-hover animate-fadeIn sm:col-span-2 lg:col-span-1" style="animation-delay: 0.2s">
        <div class="flex justify-between items-start">
          <div class="flex-1">
            <h3 class="text-neutral-500 text-xs sm:text-sm font-medium mb-1">å‚ä¸å›¢é˜Ÿæ•°</h3>
            <div class="flex items-end gap-2 mt-2">
              <span class="text-2xl sm:text-3xl font-bold number-scroll" id="teamCount">24</span>
              <span class="text-neutral-600 text-sm mb-1">ä¸ª</span>
            </div>
          </div>
          <div class="bg-secondary/10 p-2.5 sm:p-3 rounded-full text-secondary">
            <i class="fa fa-users text-xl sm:text-2xl"></i>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ä¸»è¦å†…å®¹ï¼šæ’è¡Œæ¦œå’Œå›¾è¡¨ -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4 sm:gap-6">
      <!-- å·¦ä¾§ï¼šæ’è¡Œæ¦œåŒºåŸŸ - é‡ç‚¹ä¼˜åŒ– -->
      <div class="lg:col-span-2 space-y-4 sm:space-y-6">
        <!-- æ’è¡Œæ¦œä¸»å¡ç‰‡ -->
        <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 animate-slideUp">
          <!-- æ’è¡Œæ¦œæ ‡é¢˜å’Œç­›é€‰ -->
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 sm:gap-4 mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-bold text-neutral-800 flex items-center gap-2">
              <i class="fa fa-trophy text-secondary"></i>
              å›¢é˜Ÿç›®æ ‡å®Œæˆç‡æ’è¡Œæ¦œ
            </h2>
            <div class="flex flex-wrap gap-2 w-full sm:w-auto">
              <button class="ranking-filter btn-primary text-xs sm:text-sm flex-1 sm:flex-none">
                è¾¾æˆç‡
              </button>
              <button class="ranking-filter btn-secondary text-xs sm:text-sm flex-1 sm:flex-none">
                ç¯æ¯”å¢é•¿
              </button>
              <button class="ranking-filter btn-secondary text-xs sm:text-sm flex-1 sm:flex-none">
                å›¢é˜Ÿè§„æ¨¡
              </button>
            </div>
          </div>
          
          <!-- å‰ä¸‰åç‰¹æ®Šå±•ç¤º - ä¼˜åŒ–ç§»åŠ¨ç«¯å¸ƒå±€ï¼Œä¿®å¤å¥–æ¯è£å‰ªé—®é¢˜ï¼Œåº•éƒ¨å¯¹é½ -->
          <div id="topThreeContainer" class="grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6 sm:mb-10 pt-8 sm:items-end">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </div>
          
          <!-- æ’è¡Œæ¦œåˆ—è¡¨ - ä¼˜åŒ–é—´è·å’Œå¯è¯»æ€§ -->
          <div class="space-y-2 sm:space-y-3 max-h-[400px] sm:max-h-[500px] overflow-y-auto pr-1 sm:pr-2 custom-scrollbar" id="rankingList">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </div>
        </div>
        
        <!-- å›¢é˜Ÿè¶‹åŠ¿å¯¹æ¯” -->
        <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 animate-slideUp" style="animation-delay: 0.1s">
          <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center gap-3 mb-4 sm:mb-6">
            <h2 class="text-lg sm:text-xl font-bold text-neutral-800 flex items-center gap-2">
              <i class="fa fa-line-chart text-primary"></i>
              å›¢é˜Ÿä¸šç»©è¶‹åŠ¿
            </h2>
            <div class="relative w-full sm:w-auto">
              <select id="teamComparison" class="input-field text-sm pr-8 appearance-none cursor-pointer">
                <option value="top3">å‰ä¸‰åå›¢é˜Ÿ</option>
                <option value="all">æ‰€æœ‰å›¢é˜Ÿå¹³å‡</option>
                <option value="custom">è‡ªå®šä¹‰é€‰æ‹©</option>
              </select>
              <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-neutral-600">
                <i class="fa fa-chevron-down text-xs"></i>
              </div>
            </div>
          </div>
          <div class="h-[250px] sm:h-[300px]">
            <canvas id="trendChart"></canvas>
          </div>
        </div>
      </div>
      
      <!-- å³ä¾§ï¼šæ•°æ®ç»Ÿè®¡ -->
      <div class="space-y-4 sm:space-y-6">
        <!-- å®æ—¶å…¬å‘Š -->
        <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 animate-slideUp" style="animation-delay: 0.2s">
          <h2 class="text-lg sm:text-xl font-bold text-neutral-800 mb-4 sm:mb-6 flex items-center gap-2">
            <i class="fa fa-bullhorn text-primary"></i>
            å®æ—¶å…¬å‘Š
          </h2>
          <div id="announcementContainer" class="space-y-3 max-h-[300px] overflow-y-auto custom-scrollbar">
            <!-- åŠ¨æ€ç”Ÿæˆå…¬å‘Šåˆ—è¡¨ -->
          </div>
          <div id="emptyAnnouncement" class="hidden text-center py-8 text-neutral-400">
            <i class="fa fa-bell-slash text-4xl mb-2"></i>
            <p class="text-sm">æš‚æ— å…¬å‘Š</p>
          </div>
        </div>
        
        <!-- è¾¾æˆç‡åˆ†å¸ƒ -->
        <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 animate-slideUp" style="animation-delay: 0.3s">
          <h2 class="text-lg sm:text-xl font-bold text-neutral-800 mb-4 sm:mb-6 flex items-center gap-2">
            <i class="fa fa-bar-chart text-secondary"></i>
            è¾¾æˆç‡åˆ†å¸ƒ
          </h2>
          <div class="h-[180px] sm:h-[200px]">
            <canvas id="achievementChart"></canvas>
          </div>
          <div class="mt-4 text-xs sm:text-sm text-neutral-500 text-center bg-neutral-50 rounded-lg p-3">
            <p>å¹³å‡è¾¾æˆç‡ï¼š<span class="font-semibold text-neutral-800" id="avgRate">67.8</span>%</p>
            <p class="mt-1">æœ€é«˜è¾¾æˆç‡ï¼š<span class="font-semibold text-success" id="maxRate">128.3</span>%</p>
          </div>
        </div>
        
        <!-- è¡¨ç°æœ€ä½³å›¢é˜Ÿ -->
        <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 animate-slideUp" style="animation-delay: 0.4s">
          <h2 class="text-lg sm:text-xl font-bold text-neutral-800 mb-4 flex items-center gap-2">
            <i class="fa fa-star text-secondary"></i>
            <span id="bestTeamTitle">è¡¨ç°æœ€ä½³å›¢é˜Ÿ</span>
          </h2>
          <div class="space-y-3 sm:space-y-4" id="bestTeamsContainer">
            <!-- åŠ¨æ€ç”Ÿæˆ -->
          </div>
          <div id="emptyBestTeams" class="hidden text-center py-8 text-neutral-400">
            <i class="fa fa-trophy text-4xl mb-2"></i>
            <p class="text-sm">æš‚æœªè®¾ç½®å¥–é¡¹</p>
          </div>
        </div>
      </div>
    </div>
    
    <!-- åå°ç®¡ç†åŒºåŸŸ - ä¼˜åŒ–è¡¨æ ¼å¸ƒå±€ -->
    <div id="adminPanel" class="hidden mt-6 sm:mt-8 animate-fadeIn">
      <!-- å¿«é€Ÿæ•°æ®å½•å…¥ -->
      <div class="bg-white rounded-xl shadow-md p-4 sm:p-6 mb-4 sm:mb-6">
        <h3 class="text-base sm:text-lg font-bold mb-4 flex items-center gap-2">
          <i class="fa fa-database text-primary"></i>
          å¿«é€Ÿæ•°æ®å½•å…¥
        </h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4">
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1">å›¢é˜Ÿåç§°</label>
            <input type="text" id="quickTeamName" placeholder="è¾“å…¥å›¢é˜Ÿåç§°" class="input-field text-sm">
          </div>
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1">æ‰€å±æ¸ é“</label>
            <select id="quickTeamChannel" class="input-field text-sm">
              <option value="ç›´æ’­éƒ¨">ç›´æ’­éƒ¨</option>
              <option value="è§†é¢‘éƒ¨">è§†é¢‘éƒ¨</option>
              <option value="å“ç‰Œéƒ¨">å“ç‰Œéƒ¨</option>
              <option value="è®¾è®¡éƒ¨">è®¾è®¡éƒ¨</option>
              <option value="å¹³å°è¿è¥">å¹³å°è¿è¥</option>
              <option value="å®¢æœéƒ¨">å®¢æœéƒ¨</option>
              <option value="å•†åŠ¡éƒ¨">å•†åŠ¡éƒ¨</option>
            </select>
          </div>
          <div>
            <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1">è¾¾æˆç‡ (%)</label>
            <input type="number" step="0.01" id="quickTeamRate" placeholder="è¾“å…¥è¾¾æˆç‡" class="input-field text-sm">
          </div>
          <div class="flex items-end">
            <button id="quickAddTeamBtn" class="w-full btn-primary text-sm flex items-center justify-center gap-2">
              <i class="fa fa-plus"></i>
              <span>æ·»åŠ å›¢é˜Ÿ</span>
            </button>
          </div>
        </div>
      </div>

      <!-- ç®¡ç†é¢æ¿ä¸»ä½“ -->
      <div class="bg-white rounded-xl shadow-md p-4 sm:p-6">
        <div class="flex justify-between items-center mb-4 sm:mb-6">
          <h2 class="text-lg sm:text-xl font-bold text-neutral-800 flex items-center gap-2">
            <i class="fa fa-cog text-primary"></i>
            åå°ç®¡ç†
          </h2>
          <button id="closeAdminPanel" class="text-neutral-500 hover:text-neutral-700 p-2">
            <i class="fa fa-times text-xl"></i>
          </button>
        </div>
        
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 sm:gap-6">
          <!-- æ•°æ®ç¼–è¾‘è¡¨æ ¼ - ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º -->
          <div class="border border-neutral-200 rounded-lg p-3 sm:p-5 lg:col-span-2">
            <h3 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
              <i class="fa fa-table text-primary"></i>
              å›¢é˜Ÿæ•°æ®ç¼–è¾‘
            </h3>
            
            <div class="overflow-x-auto -mx-3 sm:mx-0">
              <div class="inline-block min-w-full align-middle">
                <table class="min-w-full divide-y divide-neutral-200">
                  <thead>
                    <tr class="bg-neutral-50">
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">æ’å</th>
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">å¤´åƒ</th>
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">å›¢é˜Ÿåç§°</th>
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">å›¢é˜Ÿå£å·</th>
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">æ¸ é“</th>
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">è¾¾æˆç‡(%)</th>
                      <th class="px-3 sm:px-4 py-3 text-left text-xs font-medium text-neutral-500 uppercase tracking-wider">å˜åŠ¨</th>
                      <th class="px-3 sm:px-4 py-3 text-right text-xs font-medium text-neutral-500 uppercase tracking-wider">æ“ä½œ</th>
                    </tr>
                  </thead>
                  <tbody id="editableTeamTable" class="bg-white divide-y divide-neutral-200 text-sm">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                  </tbody>
                </table>
              </div>
            </div>
            
            <div class="mt-4 flex flex-col sm:flex-row justify-between items-stretch sm:items-center gap-3">
              <button id="addRowBtn" class="btn-secondary flex items-center justify-center gap-2 text-sm">
                <i class="fa fa-plus"></i>
                <span>æ·»åŠ æ–°å›¢é˜Ÿ</span>
              </button>
              <button id="saveDataBtn" class="bg-success hover:bg-success/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                <i class="fa fa-save"></i>
                <span>ä¿å­˜æ›´æ”¹</span>
              </button>
            </div>
          </div>
          
          <!-- ç³»ç»Ÿè®¾ç½® -->
          <div class="border border-neutral-200 rounded-lg p-3 sm:p-5 lg:col-span-2">
            <h3 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
              <i class="fa fa-sliders text-primary"></i>
              ç³»ç»Ÿè®¾ç½®
            </h3>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
              <div>
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1">è‡ªåŠ¨åˆ·æ–°é—´éš” (ç§’)</label>
                <input type="number" id="refreshInterval" value="30" min="10" max="600" class="input-field text-sm">
              </div>
              
              <div>
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1">æ•°æ®æ¥æº</label>
                <select id="dataSource" class="input-field text-sm">
                  <option value="local">æœ¬åœ°æ•°æ®</option>
                  <option value="api">APIæ¥å£</option>
                  <option value="manual">æ‰‹åŠ¨è¾“å…¥</option>
                </select>
              </div>
              
              <div>
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1">æ’è¡Œæ¦œæ˜¾ç¤ºæ•°é‡</label>
                <input type="number" id="rankingCount" value="10" min="5" max="50" class="input-field text-sm">
              </div>
              
              <div class="sm:col-span-2">
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-1 flex items-center gap-2">
                  <i class="fa fa-calendar text-primary"></i>
                  æ´»åŠ¨ç»“æŸæ—¶é—´
                </label>
                <div class="flex gap-2">
                  <input type="datetime-local" id="activityEndTime" class="input-field text-sm flex-1">
                  <button id="resetEndTimeBtn" class="btn-secondary text-sm px-3 whitespace-nowrap" title="é‡ç½®ä¸ºé»˜è®¤æ—¶é—´">
                    <i class="fa fa-refresh mr-1"></i>
                    é‡ç½®
                  </button>
                </div>
                <p class="text-xs text-neutral-500 mt-1">
                  <i class="fa fa-info-circle"></i>
                  é»˜è®¤æ—¶é—´ï¼š2024-11-11 23:59:59
                </p>
              </div>
              
              <div class="flex items-center gap-2">
                <input type="checkbox" id="enableAnimation" checked class="w-4 h-4 text-primary border-neutral-300 rounded focus:ring-primary">
                <label for="enableAnimation" class="text-xs sm:text-sm text-neutral-700">å¯ç”¨åŠ¨ç”»æ•ˆæœ</label>
              </div>
              
              <div class="flex items-center gap-2">
                <input type="checkbox" id="enableNotification" class="w-4 h-4 text-primary border-neutral-300 rounded focus:ring-primary">
                <label for="enableNotification" class="text-xs sm:text-sm text-neutral-700">å¯ç”¨æ•°æ®å˜åŠ¨é€šçŸ¥</label>
              </div>
              
              <div class="sm:col-span-2">
                <button id="saveSettingsBtn" class="w-full btn-primary text-sm">
                  <i class="fa fa-save mr-2"></i>
                  ä¿å­˜è®¾ç½®
                </button>
              </div>
            </div>
          </div>
          
          <!-- æ•°æ®å¯¼å…¥å¯¼å‡º -->
          <div class="border border-neutral-200 rounded-lg p-3 sm:p-5 lg:col-span-2 mt-4">
            <h3 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
              <i class="fa fa-exchange text-primary"></i>
              æ•°æ®å¯¼å…¥å¯¼å‡º
            </h3>
            
            <div class="space-y-4">
              <!-- å¯¼å‡ºåŠŸèƒ½ -->
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-blue-800 mb-2 flex items-center gap-2">
                  <i class="fa fa-download"></i>
                  å¯¼å‡ºæ•°æ®
                </h4>
                <p class="text-xs text-blue-700 mb-3">
                  å°†æ‰€æœ‰æ•°æ®ï¼ˆå›¢é˜Ÿã€å…¬å‘Šã€è¶‹åŠ¿ã€å¥–é¡¹ç­‰ï¼‰å¯¼å‡ºä¸ºJSONæ–‡ä»¶ï¼Œå¯åˆ†äº«ç»™ä»–äººæˆ–ç”¨äºå¤‡ä»½ã€‚
                </p>
                <button id="exportDataBtn" class="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                  <i class="fa fa-download"></i>
                  <span>å¯¼å‡ºæ‰€æœ‰æ•°æ®</span>
                </button>
              </div>
              
              <!-- å¯¼å…¥åŠŸèƒ½ -->
              <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-green-800 mb-2 flex items-center gap-2">
                  <i class="fa fa-upload"></i>
                  å¯¼å…¥æ•°æ®
                </h4>
                <p class="text-xs text-green-700 mb-3">
                  ä»DROP_JSON_FILE_PLACEä¸­å¯¼å…¥æ•°æ®ï¼Œå°†è¦†ç›–å½“å‰æœ¬åœ°æ‰€æœ‰æ•°æ®ï¼Œè¯·è°¨æ…æ“ä½œã€‚
                </p>
                <input type="file" id="importDataInput" accept=".json" class="hidden">
                <button id="importDataBtn" class="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                  <i class="fa fa-upload"></i>
                  <span>é€‰æ‹©æ–‡ä»¶å¯¼å…¥</span>
                </button>
              </div>
              
              <!-- æ¸…ç©ºæ•°æ® -->
              <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                <h4 class="text-sm font-semibold text-red-800 mb-2 flex items-center gap-2">
                  <i class="fa fa-trash"></i>
                  æ¸…ç©ºæ•°æ®
                </h4>
                <p class="text-xs text-red-700 mb-3">
                  æ¸…ç©ºæ‰€æœ‰æœ¬åœ°å­˜å‚¨çš„æ•°æ®ï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€ï¼Œæ­¤æ“ä½œä¸å¯æ¢å¤ï¼
                </p>
                <button id="clearAllDataBtn" class="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                  <i class="fa fa-trash"></i>
                  <span>æ¸…ç©ºæ‰€æœ‰æ•°æ®</span>
                </button>
              </div>
              
              <!-- ä½¿ç”¨è¯´æ˜ -->
              <div class="bg-neutral-50 border border-neutral-200 rounded-lg p-3 text-xs text-neutral-600">
                <p class="font-semibold mb-2">ğŸ’¡ ä½¿ç”¨è¯´æ˜ï¼š</p>
                <ul class="space-y-1 ml-4 list-disc">
                  <li><strong>å¯¼å‡ºæ•°æ®ï¼š</strong>ç‚¹å‡»åä¼šä¸‹è½½ä¸€ä¸ªJSONæ–‡ä»¶ï¼ŒåŒ…å«æ‰€æœ‰å›¢é˜Ÿã€å…¬å‘Šã€è¶‹åŠ¿ç­‰æ•°æ®</li>
                  <li><strong>åˆ†äº«æ•°æ®ï¼š</strong>å°†å¯¼å‡ºçš„JSONæ–‡ä»¶å‘é€ç»™ä»–äººï¼Œä»–ä»¬å¯¼å…¥åå³å¯çœ‹åˆ°ç›¸åŒæ•°æ®</li>
                  <li><strong>å¤‡ä»½æ•°æ®ï¼š</strong>å®šæœŸå¯¼å‡ºæ•°æ®ï¼Œé˜²æ­¢æ•°æ®ä¸¢å¤±</li>
                  <li><strong>å¯¼å…¥æ•°æ®ï¼š</strong>é€‰æ‹©ä¹‹å‰å¯¼å‡ºçš„JSONæ–‡ä»¶ï¼Œå³å¯æ¢å¤æ•°æ®</li>
                </ul>
              </div>
            </div>
          </div>
          
          <!-- è¶‹åŠ¿æ•°æ®ç¼–è¾‘ -->
          <div class="border border-neutral-200 rounded-lg p-3 sm:p-5 lg:col-span-2 mt-4">
            <h3 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
              <i class="fa fa-line-chart text-primary"></i>
              è¶‹åŠ¿æ•°æ®ç¼–è¾‘
            </h3>
            
            <div class="space-y-4">
              <!-- æ—¥æœŸç®¡ç† -->
              <div>
                <div class="flex justify-between items-center mb-2">
                  <label class="block text-xs sm:text-sm font-medium text-neutral-700">
                    æ—¥æœŸèŠ‚ç‚¹
                    <span id="trendDateCount" class="text-neutral-500 font-normal ml-1">(7ä¸ª)</span>
                  </label>
                  <div class="flex gap-2">
                    <button id="addTrendDateBtn" class="btn-secondary text-sm px-3 py-1.5 flex items-center gap-1">
                      <i class="fa fa-plus"></i>
                      <span>æ·»åŠ æ—¥æœŸ</span>
                    </button>
                    <button id="resetTrendDatesBtn" class="btn-secondary text-sm px-3 py-1.5 flex items-center gap-1">
                      <i class="fa fa-refresh"></i>
                      <span>é‡ç½®é»˜è®¤</span>
                    </button>
                  </div>
                </div>
                <div id="trendDatesList" class="flex flex-wrap gap-2 bg-neutral-50 rounded-lg p-3">
                  <!-- åŠ¨æ€ç”Ÿæˆæ—¥æœŸæ ‡ç­¾ -->
                </div>
              </div>
              
              <!-- è¶‹åŠ¿æ•°æ®è¡¨æ ¼ -->
              <div>
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-2">
                  å›¢é˜Ÿè¶‹åŠ¿æ•°æ®
                  <span class="text-neutral-500 font-normal ml-2">(è¾“å…¥ç™¾åˆ†æ¯”æ•°å€¼)</span>
                </label>
                <div class="overflow-x-auto -mx-3 sm:mx-0">
                  <div class="inline-block min-w-full align-middle">
                    <div id="trendDataTable" class="bg-neutral-50 rounded-lg p-3 max-h-96 overflow-y-auto custom-scrollbar">
                      <!-- åŠ¨æ€ç”Ÿæˆè¶‹åŠ¿æ•°æ®è¡¨æ ¼ -->
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- æ“ä½œæŒ‰é’® -->
              <div class="flex gap-3 pt-2">
                <button id="saveTrendDataBtn" class="flex-1 bg-success hover:bg-success/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                  <i class="fa fa-save"></i>
                  <span>ä¿å­˜è¶‹åŠ¿æ•°æ®</span>
                </button>
                <button id="autoGenerateTrendBtn" class="btn-secondary text-sm px-4 py-2 flex items-center gap-2">
                  <i class="fa fa-magic"></i>
                  <span>æ™ºèƒ½ç”Ÿæˆ</span>
                </button>
              </div>
              
              <div class="bg-blue-50 border border-blue-200 rounded-lg p-3 text-xs text-blue-700">
                <i class="fa fa-info-circle mr-1"></i>
                <strong>æç¤ºï¼š</strong>
                <ul class="mt-1 ml-4 list-disc space-y-1">
                  <li>è¶‹åŠ¿æ•°æ®ä¼šè‡ªåŠ¨åŒæ­¥å›¢é˜ŸåŸºæœ¬ä¿¡æ¯ï¼ˆå›¢é˜Ÿå¢åˆ ã€æ”¹åç­‰ï¼‰</li>
                  <li>ç‚¹å‡»â€œæ™ºèƒ½ç”Ÿæˆâ€å¯æ ¹æ®å½“å‰è¾¾æˆç‡è‡ªåŠ¨ç”Ÿæˆè¶‹åŠ¿æ•°æ®</li>
                  <li>æ—¥æœŸæ ‡ç­¾å¯ç‚¹å‡»åˆ é™¤ï¼Œè‡³å°‘ä¿ç•™ä¸¤ä¸ªæ—¥æœŸ</li>
                </ul>
              </div>
            </div>
          </div>
          
          <!-- å…¬å‘Šç®¡ç† -->
          <div class="border border-neutral-200 rounded-lg p-3 sm:p-5 lg:col-span-2 mt-4">
            <h3 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
              <i class="fa fa-bullhorn text-primary"></i>
              å…¬å‘Šç®¡ç†
            </h3>
            
            <div class="space-y-4">
              <!-- å…¬å‘Šç¼–è¾‘æ¡† -->
              <div>
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-2">
                  å…¬å‘Šå†…å®¹
                  <span class="text-neutral-500 font-normal ml-2">(æœ€å¤š500å­—)</span>
                </label>
                <textarea 
                  id="announcementInput" 
                  rows="4" 
                  maxlength="500"
                  placeholder="è¯·è¾“å…¥å…¬å‘Šå†…å®¹..." 
                  class="input-field text-sm resize-none"
                ></textarea>
                <div class="flex justify-between items-center mt-1">
                  <span class="text-xs text-neutral-500">
                    <i class="fa fa-info-circle"></i>
                    æœ€å¤šä¿ç•™æœ€è¿‘20æ¡å…¬å‘Š
                  </span>
                  <span id="announcementCharCount" class="text-xs text-neutral-500">0/500</span>
                </div>
              </div>
              
              <!-- æ“ä½œæŒ‰é’® -->
              <div class="flex gap-3">
                <button id="publishAnnouncementBtn" class="flex-1 bg-success hover:bg-success/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                  <i class="fa fa-send"></i>
                  <span>å‘å¸ƒå…¬å‘Š</span>
                </button>
                <button id="clearAnnouncementsBtn" class="btn-secondary flex items-center gap-2 text-sm">
                  <i class="fa fa-trash"></i>
                  <span>æ¸…é™¤å†å²</span>
                </button>
              </div>
              
              <!-- å…¬å‘Šå†å²åˆ—è¡¨ -->
              <div>
                <div class="flex justify-between items-center mb-2">
                  <label class="block text-xs sm:text-sm font-medium text-neutral-700">
                    å…¬å‘Šå†å²
                    <span id="announcementCount" class="text-neutral-500 font-normal ml-1">(0æ¡)</span>
                  </label>
                </div>
                <div id="announcementHistoryList" class="space-y-2 max-h-60 overflow-y-auto custom-scrollbar bg-neutral-50 rounded-lg p-3">
                  <!-- åŠ¨æ€ç”Ÿæˆå†å²å…¬å‘Š -->
                </div>
              </div>
            </div>
          </div>
          
          <!-- æœ€ä½³å›¢é˜Ÿå¥–é¡¹è®¾ç½® -->
          <div class="border border-neutral-200 rounded-lg p-3 sm:p-5 lg:col-span-2 mt-4">
            <h3 class="text-base sm:text-lg font-semibold mb-4 flex items-center gap-2">
              <i class="fa fa-trophy text-secondary"></i>
              æœ€ä½³å›¢é˜Ÿå¥–é¡¹è®¾ç½®
            </h3>
            
            <div class="space-y-4">
              <!-- å¥–é¡¹æ ‡é¢˜è®¾ç½® -->
              <div>
                <label class="block text-xs sm:text-sm font-medium text-neutral-700 mb-2">
                  æ¿å—æ ‡é¢˜
                  <span class="text-neutral-500 font-normal ml-2">(å¦‚ï¼šè¡¨ç°æœ€ä½³å›¢é˜Ÿã€ä¼˜ç§€å›¢é˜Ÿæ¦œç­‰)</span>
                </label>
                <input 
                  type="text" 
                  id="awardBlockTitle" 
                  placeholder="è¯·è¾“å…¥æ¿å—æ ‡é¢˜" 
                  maxlength="20"
                  class="input-field text-sm"
                >
              </div>
              
              <!-- å¥–é¡¹åˆ—è¡¨ -->
              <div>
                <div class="flex justify-between items-center mb-2">
                  <label class="block text-xs sm:text-sm font-medium text-neutral-700">
                    å¥–é¡¹é…ç½®
                    <span id="awardCount" class="text-neutral-500 font-normal ml-1">(0ä¸ª)</span>
                  </label>
                  <button id="addAwardBtn" class="btn-secondary text-sm px-3 py-1.5 flex items-center gap-1">
                    <i class="fa fa-plus"></i>
                    <span>æ·»åŠ å¥–é¡¹</span>
                  </button>
                </div>
                
                <div id="awardsList" class="space-y-3 max-h-96 overflow-y-auto custom-scrollbar bg-neutral-50 rounded-lg p-3">
                  <!-- åŠ¨æ€ç”Ÿæˆå¥–é¡¹é…ç½®é¡¹ -->
                </div>
              </div>
              
              <!-- ä¿å­˜æŒ‰é’® -->
              <div class="flex gap-3 pt-2">
                <button id="saveAwardsBtn" class="flex-1 bg-success hover:bg-success/90 text-white px-4 py-2 rounded-lg transition-colors flex items-center justify-center gap-2 text-sm">
                  <i class="fa fa-save"></i>
                  <span>ä¿å­˜å¥–é¡¹è®¾ç½®</span>
                </button>
                <button id="resetAwardsBtn" class="btn-secondary text-sm px-4 py-2 flex items-center gap-2">
                  <i class="fa fa-refresh"></i>
                  <span>æ¢å¤é»˜è®¤</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- é¡µè„š -->
  <footer class="bg-white border-t border-neutral-200 py-4 sm:py-6 mt-8 sm:mt-12">
    <div class="container mx-auto px-4 sm:px-6 lg:px-8 text-center text-neutral-500 text-xs sm:text-sm">
      <p>&copy; 2025 å¥¹è¯­åŒåä¸€å›¢é˜Ÿç›®æ ‡å®Œæˆç‡æ’è¡Œæ¦œ | æ•°æ®æ›´æ–°æ—¶é—´: <span id="lastUpdateTime">2024-11-05 14:30:25</span></p>
    </div>
  </footer>

  <!-- æ¶ˆæ¯æç¤ºå®¹å™¨ -->
  <div id="messageContainer" class="fixed bottom-4 right-4 z-50 space-y-2 max-w-sm"></div>

  <!-- JavaScript -->
  <script>
    // å…¨å±€å˜é‡
    let teamData = [];
    let charts = {};
    let isEventListenersSetup = false;
    let autoRefreshTimer = null;
    let countdownTimer = null;
    const DEFAULT_END_TIME = '2024-11-11T23:59:59';
    let announcements = [];
    const MAX_ANNOUNCEMENTS = 20;
    let awards = [];
    const DEFAULT_AWARD_TITLE = 'è¡¨ç°æœ€ä½³å›¢é˜Ÿ';
    let trendData = {}; // å­˜å‚¨è¶‹åŠ¿æ•°æ®
    let trendDates = []; // å­˜å‚¨æ—¥æœŸèŠ‚ç‚¹
    
    // åŠ è½½è¶‹åŠ¿æ•°æ®
    function loadTrendData() {
      const saved = localStorage.getItem('trendData');
      if (saved) {
        const data = JSON.parse(saved);
        trendDates = data.dates || getDefaultTrendDates();
        trendData = data.teamData || {};
        
        // ç¡®ä¿æ‰€æœ‰å›¢é˜Ÿéƒ½æœ‰è¶‹åŠ¿æ•°æ®
        syncTrendDataWithTeams();
      } else {
        // åˆå§‹åŒ–é»˜è®¤æ•°æ®
        trendDates = getDefaultTrendDates();
        initializeTrendData();
      }
    }

    // è·å–é»˜è®¤æ—¥æœŸèŠ‚ç‚¹ï¼ˆæœ€è¿‘7å¤©ï¼‰
    function getDefaultTrendDates() {
      const dates = [];
      const today = new Date();
      for (let i = 6; i >= 0; i--) {
        const date = new Date(today);
        date.setDate(date.getDate() - i);
        const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;
        dates.push(dateStr);
      }
      return dates;
    }

    // åˆå§‹åŒ–è¶‹åŠ¿æ•°æ®
    function initializeTrendData() {
      trendData = {};
      teamData.forEach(team => {
        trendData[team.id] = generateTrendDataForTeam(team.rate);
      });
    }

    // ä¸ºå•ä¸ªå›¢é˜Ÿç”Ÿæˆè¶‹åŠ¿æ•°æ®
    function generateTrendDataForTeam(currentRate) {
      const data = [];
      let rate = currentRate * 0.5; // ä»50%å¼€å§‹
      for (let i = 0; i < trendDates.length; i++) {
        data.push(Math.round(rate * 100) / 100);
        rate += (currentRate - rate) / (trendDates.length - i);
      }
      return data;
    }

    // åŒæ­¥è¶‹åŠ¿æ•°æ®ä¸å›¢é˜Ÿæ•°æ®
    function syncTrendDataWithTeams() {
      // åˆ é™¤å·²ä¸å­˜åœ¨çš„å›¢é˜Ÿ
      const teamIds = teamData.map(t => t.id);
      Object.keys(trendData).forEach(id => {
        if (!teamIds.includes(parseInt(id))) {
          delete trendData[id];
        }
      });
      
      // ä¸ºæ–°å›¢é˜Ÿæ·»åŠ è¶‹åŠ¿æ•°æ®
      teamData.forEach(team => {
        if (!trendData[team.id]) {
          trendData[team.id] = generateTrendDataForTeam(team.rate);
        }
      });
    }

    // ä¿å­˜è¶‹åŠ¿æ•°æ®
    function saveTrendData() {
      const data = {
        dates: trendDates,
        teamData: trendData
      };
      localStorage.setItem('trendData', JSON.stringify(data));
    }

    // æ¸²æŸ“æ—¥æœŸåˆ—è¡¨
    function renderTrendDates() {
      const container = document.getElementById('trendDatesList');
      const countElement = document.getElementById('trendDateCount');
      
      countElement.textContent = `(${trendDates.length}ä¸ª)`;
      
      let html = '';
      trendDates.forEach((date, index) => {
        html += `
          <div class="inline-flex items-center gap-2 bg-white px-3 py-1.5 rounded-lg border border-neutral-200 text-sm">
            <span>${date}</span>
            ${trendDates.length > 2 ? `
              <button class="delete-date-btn text-primary hover:text-primary/80" data-index="${index}" title="åˆ é™¤">
                <i class="fa fa-times"></i>
              </button>
            ` : ''}
          </div>
        `;
      });
      
      container.innerHTML = html;
      
      // ç»‘å®šåˆ é™¤äº‹ä»¶
      container.querySelectorAll('.delete-date-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          deleteTrendDate(index);
        });
      });
    }

    // æ¸²æŸ“è¶‹åŠ¿æ•°æ®è¡¨æ ¼
    function renderTrendDataTable() {
      const container = document.getElementById('trendDataTable');
      
      if (teamData.length === 0) {
        container.innerHTML = '<div class="text-center text-neutral-400 py-6 text-sm">æš‚æ— å›¢é˜Ÿæ•°æ®</div>';
        return;
      }
      
      let html = '<table class="min-w-full bg-white rounded-lg overflow-hidden text-sm">';
      
      // è¡¨å¤´
      html += '<thead class="bg-neutral-100">';
      html += '<tr>';
      html += '<th class="px-3 py-2 text-left text-xs font-medium text-neutral-600 sticky left-0 bg-neutral-100">å›¢é˜Ÿåç§°</th>';
      trendDates.forEach(date => {
        html += `<th class="px-3 py-2 text-center text-xs font-medium text-neutral-600 whitespace-nowrap">${date}</th>`;
      });
      html += '</tr>';
      html += '</thead>';
      
      // è¡¨ä½“
      html += '<tbody class="divide-y divide-neutral-200">';
      teamData.forEach(team => {
        html += '<tr class="hover:bg-neutral-50">';
        html += `<td class="px-3 py-2 font-medium text-neutral-800 sticky left-0 bg-white">${team.name}</td>`;
        
        const teamTrendData = trendData[team.id] || [];
        trendDates.forEach((date, dateIndex) => {
          const value = teamTrendData[dateIndex] || 0;
          html += `
            <td class="px-2 py-2">
              <input 
                type="number" 
                step="0.01" 
                class="trend-data-input input-field text-sm py-1 w-20 text-center" 
                value="${value.toFixed(2)}" 
                data-team-id="${team.id}"
                data-date-index="${dateIndex}"
                placeholder="0.00"
              >
            </td>
          `;
        });
        html += '</tr>';
      });
      html += '</tbody>';
      html += '</table>';
      
      container.innerHTML = html;
      
      // ç»‘å®šè¾“å…¥äº‹ä»¶
      container.querySelectorAll('.trend-data-input').forEach(input => {
        input.addEventListener('input', function() {
          const teamId = parseInt(this.dataset.teamId);
          const dateIndex = parseInt(this.dataset.dateIndex);
          const value = Math.round((parseFloat(this.value) || 0) * 100) / 100;
          
          if (!trendData[teamId]) {
            trendData[teamId] = [];
          }
          trendData[teamId][dateIndex] = value;
        });
      });
    }

    // æ·»åŠ æ—¥æœŸèŠ‚ç‚¹
    function addTrendDate() {
      const dateInput = prompt('è¯·è¾“å…¥æ—¥æœŸï¼ˆæ ¼å¼ï¼šM/Dï¼Œå¦‚ï¼š11/6ï¼‰ï¼š');
      if (!dateInput) return;
      
      const dateRegex = /^(\d{1,2})\/(\d{1,2})$/;
      if (!dateRegex.test(dateInput.trim())) {
        showMessage('æ—¥æœŸæ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä½¿ç”¨ M/D æ ¼å¼', 'error');
        return;
      }
      
      trendDates.push(dateInput.trim());
      
      // ä¸ºæ‰€æœ‰å›¢é˜Ÿæ·»åŠ è¯¥æ—¥æœŸçš„æ•°æ®ï¼ˆé»˜è®¤0ï¼‰
      Object.keys(trendData).forEach(teamId => {
        trendData[teamId].push(0);
      });
      
      renderTrendDates();
      renderTrendDataTable();
      showMessage('æ—¥æœŸèŠ‚ç‚¹å·²æ·»åŠ ', 'success');
    }

    // åˆ é™¤æ—¥æœŸèŠ‚ç‚¹
    function deleteTrendDate(index) {
      if (trendDates.length <= 2) {
        showMessage('è‡³å°‘éœ€è¦ä¿ç•™ä¸¤ä¸ªæ—¥æœŸèŠ‚ç‚¹', 'error');
        return;
      }
      
      if (confirm(`ç¡®å®šè¦åˆ é™¤æ—¥æœŸ "${trendDates[index]}" å—ï¼Ÿ`)) {
        trendDates.splice(index, 1);
        
        // åˆ é™¤æ‰€æœ‰å›¢é˜Ÿè¯¥æ—¥æœŸçš„æ•°æ®
        Object.keys(trendData).forEach(teamId => {
          trendData[teamId].splice(index, 1);
        });
        
        renderTrendDates();
        renderTrendDataTable();
        showMessage('æ—¥æœŸèŠ‚ç‚¹å·²åˆ é™¤', 'success');
      }
    }

    // é‡ç½®æ—¥æœŸä¸ºé»˜è®¤ï¼ˆæœ€è¿‘7å¤©ï¼‰
    function resetTrendDates() {
      if (confirm('ç¡®å®šè¦é‡ç½®ä¸ºé»˜è®¤æ—¥æœŸï¼ˆæœ€è¿‘7å¤©ï¼‰å—ï¼Ÿå½“å‰è¶‹åŠ¿æ•°æ®å°†è¢«æ¸…ç©ºï¼')) {
        trendDates = getDefaultTrendDates();
        initializeTrendData();
        renderTrendDates();
        renderTrendDataTable();
        showMessage('å·²é‡ç½®ä¸ºé»˜è®¤æ—¥æœŸ', 'success');
      }
    }

    // æ™ºèƒ½ç”Ÿæˆè¶‹åŠ¿æ•°æ®
    function autoGenerateTrendData() {
      if (confirm('ç¡®å®šè¦æ ¹æ®å½“å‰è¾¾æˆç‡è‡ªåŠ¨ç”Ÿæˆè¶‹åŠ¿æ•°æ®å—ï¼Ÿå½“å‰æ‰‹åŠ¨è¾“å…¥çš„æ•°æ®å°†è¢«è¦†ç›–ï¼')) {
        initializeTrendData();
        renderTrendDataTable();
        showMessage('è¶‹åŠ¿æ•°æ®å·²æ™ºèƒ½ç”Ÿæˆ', 'success');
      }
    }

    // ä¿å­˜è¶‹åŠ¿æ•°æ®å¹¶æ›´æ–°å›¾è¡¨
    function saveTrendDataAndUpdateChart() {
      // éªŒè¯æ•°æ®
      for (const teamId in trendData) {
        const data = trendData[teamId];
        if (data.length !== trendDates.length) {
          showMessage('æ•°æ®é•¿åº¦ä¸ä¸€è‡´ï¼Œè¯·æ£€æŸ¥', 'error');
          return;
        }
      }
      
      saveTrendData();
      updateTrendChart('top3'); // æ›´æ–°å›¾è¡¨
      showMessage('è¶‹åŠ¿æ•°æ®å·²ä¿å­˜ï¼Œå›¾è¡¨å·²æ›´æ–°', 'success');
    }

    // åŠ è½½å¥–é¡¹æ•°æ®
    function loadAwards() {
      const saved = localStorage.getItem('awards');
      if (saved) {
        const data = JSON.parse(saved);
        awards = data.awards || [];
        document.getElementById('awardBlockTitle').value = data.blockTitle || DEFAULT_AWARD_TITLE;
      } else {
        // é»˜è®¤å¥–é¡¹è®¾ç½®
        awards = [
          { id: 1, name: 'é‡‘ç‰Œå›¢é˜Ÿ', icon: 'trophy', color: 'text-secondary', bg: 'bg-secondary/10' },
          { id: 2, name: 'é“¶ç‰Œå›¢é˜Ÿ', icon: 'star', color: 'text-neutral-400', bg: 'bg-neutral-200' },
          { id: 3, name: 'é“œç‰Œå›¢é˜Ÿ', icon: 'certificate', color: 'text-amber-700', bg: 'bg-amber-100' }
        ];
        document.getElementById('awardBlockTitle').value = DEFAULT_AWARD_TITLE;
      }
    }

    // ä¿å­˜å¥–é¡¹æ•°æ®
    function saveAwards() {
      const blockTitle = document.getElementById('awardBlockTitle').value.trim() || DEFAULT_AWARD_TITLE;
      const data = {
        blockTitle: blockTitle,
        awards: awards
      };
      localStorage.setItem('awards', JSON.stringify(data));
    }

    // è·å–å¯ç”¨çš„å›¾æ ‡åˆ—è¡¨
    function getAwardIcons() {
      return [
        { value: 'trophy', label: 'å¥–æ¯', icon: 'fa-trophy' },
        { value: 'star', label: 'æ˜Ÿæ˜Ÿ', icon: 'fa-star' },
        { value: 'certificate', label: 'è¯ä¹¦', icon: 'fa-certificate' },
        { value: 'medal', label: 'å¥–ç‰Œ', icon: 'fa-shield' },
        { value: 'crown', label: 'çš‡å† ', icon: 'fa-diamond' },
        { value: 'heart', label: 'çˆ±å¿ƒ', icon: 'fa-heart' },
        { value: 'flag', label: 'æ——å¸œ', icon: 'fa-flag' },
        { value: 'gift', label: 'ç¤¼ç‰©', icon: 'fa-gift' }
      ];
    }

    // è·å–å¯ç”¨çš„é¢œè‰²åˆ—è¡¨
    function getAwardColors() {
      return [
        { value: 'text-secondary', bg: 'bg-secondary/10', label: 'é‡‘è‰²' },
        { value: 'text-neutral-400', bg: 'bg-neutral-200', label: 'é“¶è‰²' },
        { value: 'text-amber-700', bg: 'bg-amber-100', label: 'é“œè‰²' },
        { value: 'text-primary', bg: 'bg-primary/10', label: 'çº¢è‰²' },
        { value: 'text-success', bg: 'bg-success/10', label: 'ç»¿è‰²' },
        { value: 'text-blue-500', bg: 'bg-blue-50', label: 'è“è‰²' },
        { value: 'text-purple-500', bg: 'bg-purple-50', label: 'ç´«è‰²' },
        { value: 'text-pink-500', bg: 'bg-pink-50', label: 'ç²‰è‰²' }
      ];
    }

    // æ¸²æŸ“å¥–é¡¹é…ç½®åˆ—è¡¨
    function renderAwardsList() {
      const container = document.getElementById('awardsList');
      const countElement = document.getElementById('awardCount');
      
      countElement.textContent = `(${awards.length}ä¸ª)`;
      
      if (awards.length === 0) {
        container.innerHTML = '<div class="text-center text-neutral-400 py-6 text-sm">æš‚æ— å¥–é¡¹é…ç½®ï¼Œç‚¹å‡»ä¸Šæ–¹"æ·»åŠ å¥–é¡¹"æŒ‰é’®å¼€å§‹è®¾ç½®</div>';
        return;
      }
      
      const icons = getAwardIcons();
      const colors = getAwardColors();
      
      let html = '';
      awards.forEach((award, index) => {
        const selectedIcon = icons.find(i => i.value === award.icon) || icons[0];
        const selectedColor = colors.find(c => c.value === award.color) || colors[0];
        
        html += `
          <div class="bg-white p-4 rounded-lg border border-neutral-200 hover:border-primary/50 transition-colors">
            <div class="flex items-center gap-3 mb-3">
              <div class="flex-shrink-0 text-neutral-500">
                <i class="fa fa-bars cursor-move"></i>
              </div>
              <div class="flex-1 font-medium text-sm text-neutral-700">
                å¥–é¡¹ #${index + 1}
              </div>
              <button class="delete-award-btn text-primary hover:text-primary/80 transition-colors" data-index="${index}" title="åˆ é™¤">
                <i class="fa fa-trash"></i>
              </button>
            </div>
            
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
              <div>
                <label class="block text-xs text-neutral-600 mb-1">å¥–é¡¹åç§°</label>
                <input 
                  type="text" 
                  class="award-name-input input-field text-sm py-1.5" 
                  value="${award.name}" 
                  data-index="${index}"
                  placeholder="å¦‚ï¼šé‡‘ç‰Œå›¢é˜Ÿ"
                  maxlength="20"
                >
              </div>
              
              <div>
                <label class="block text-xs text-neutral-600 mb-1">æŒ‡å®šå›¢é˜Ÿ</label>
                <select class="award-team-select input-field text-sm py-1.5" data-index="${index}">
                  <option value="">è‡ªåŠ¨åˆ†é…(æŒ‰æ’å)</option>
                  ${teamData.map(team => `
                    <option value="${team.id}" ${award.teamId === team.id ? 'selected' : ''}>
                      ${team.name}
                    </option>
                  `).join('')}
                </select>
              </div>
              
              <div>
                <label class="block text-xs text-neutral-600 mb-1">å›¾æ ‡</label>
                <select class="award-icon-select input-field text-sm py-1.5" data-index="${index}">
                  ${icons.map(icon => `
                    <option value="${icon.value}" ${award.icon === icon.value ? 'selected' : ''}>
                      ${icon.label}
                    </option>
                  `).join('')}
                </select>
              </div>
              
              <div>
                <label class="block text-xs text-neutral-600 mb-1">é¢œè‰²</label>
                <select class="award-color-select input-field text-sm py-1.5" data-index="${index}">
                  ${colors.map(color => `
                    <option value="${color.value}" data-bg="${color.bg}" ${award.color === color.value ? 'selected' : ''}>
                      ${color.label}
                    </option>
                  `).join('')}
                </select>
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
      
      // ç»‘å®šäº‹ä»¶
      setupAwardInputListeners();
    }

    // è®¾ç½®å¥–é¡¹è¾“å…¥äº‹ä»¶ç›‘å¬
    function setupAwardInputListeners() {
      // å¥–é¡¹åç§°è¾“å…¥
      document.querySelectorAll('.award-name-input').forEach(input => {
        input.addEventListener('input', function() {
          const index = parseInt(this.dataset.index);
          awards[index].name = this.value.trim();
        });
      });
      
      // å›¢é˜Ÿé€‰æ‹©
      document.querySelectorAll('.award-team-select').forEach(select => {
        select.addEventListener('change', function() {
          const index = parseInt(this.dataset.index);
          awards[index].teamId = this.value ? parseInt(this.value) : null;
        });
      });
      
      // å›¾æ ‡é€‰æ‹©
      document.querySelectorAll('.award-icon-select').forEach(select => {
        select.addEventListener('change', function() {
          const index = parseInt(this.dataset.index);
          awards[index].icon = this.value;
        });
      });
      
      // é¢œè‰²é€‰æ‹©
      document.querySelectorAll('.award-color-select').forEach(select => {
        select.addEventListener('change', function() {
          const index = parseInt(this.dataset.index);
          const selectedOption = this.options[this.selectedIndex];
          awards[index].color = this.value;
          awards[index].bg = selectedOption.dataset.bg;
        });
      });
      
      // åˆ é™¤æŒ‰é’®
      document.querySelectorAll('.delete-award-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          deleteAward(index);
        });
      });
    }

    // æ·»åŠ æ–°å¥–é¡¹
    function addNewAward() {
      const newAward = {
        id: Date.now(),
        name: `æ–°å¥–é¡¹${awards.length + 1}`,
        teamId: null,
        icon: 'trophy',
        color: 'text-secondary',
        bg: 'bg-secondary/10'
      };
      
      awards.push(newAward);
      renderAwardsList();
      showMessage('å·²æ·»åŠ æ–°å¥–é¡¹', 'success');
    }

    // åˆ é™¤å¥–é¡¹
    function deleteAward(index) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¥–é¡¹å—ï¼Ÿ')) {
        awards.splice(index, 1);
        renderAwardsList();
        showMessage('å¥–é¡¹å·²åˆ é™¤', 'success');
      }
    }

    // ä¿å­˜å¥–é¡¹è®¾ç½®
    function saveAwardsSettings() {
      const blockTitle = document.getElementById('awardBlockTitle').value.trim();
      
      if (!blockTitle) {
        showMessage('è¯·è¾“å…¥æ¿å—æ ‡é¢˜', 'error');
        document.getElementById('awardBlockTitle').focus();
        return;
      }
      
      // éªŒè¯å¥–é¡¹åç§°
      for (let i = 0; i < awards.length; i++) {
        if (!awards[i].name || awards[i].name.trim() === '') {
          showMessage(`è¯·å¡«å†™å¥–é¡¹ #${i + 1} çš„åç§°`, 'error');
          return;
        }
      }
      
      saveAwards();
      renderBestTeams();
      showMessage('å¥–é¡¹è®¾ç½®å·²ä¿å­˜', 'success');
    }

    // é‡ç½®å¥–é¡¹è®¾ç½®
    function resetAwardsSettings() {
      if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤å¥–é¡¹è®¾ç½®å—ï¼Ÿ')) {
        awards = [
          { id: 1, name: 'é‡‘ç‰Œå›¢é˜Ÿ', icon: 'trophy', color: 'text-secondary', bg: 'bg-secondary/10', teamId: null },
          { id: 2, name: 'é“¶ç‰Œå›¢é˜Ÿ', icon: 'star', color: 'text-neutral-400', bg: 'bg-neutral-200', teamId: null },
          { id: 3, name: 'é“œç‰Œå›¢é˜Ÿ', icon: 'certificate', color: 'text-amber-700', bg: 'bg-amber-100', teamId: null }
        ];
        document.getElementById('awardBlockTitle').value = DEFAULT_AWARD_TITLE;
        renderAwardsList();
        saveAwards();
        renderBestTeams();
        showMessage('å·²æ¢å¤é»˜è®¤è®¾ç½®', 'success');
      }
    }

    // åŠ è½½å…¬å‘Šæ•°æ®
    function loadAnnouncements() {
      const saved = localStorage.getItem('announcements');
      if (saved) {
        announcements = JSON.parse(saved);
      } else {
        announcements = [];
      }
    }

    // ä¿å­˜å…¬å‘Šæ•°æ®
    function saveAnnouncements() {
      localStorage.setItem('announcements', JSON.stringify(announcements));
    }

    // è·å–ç›¸å¯¹æ—¶é—´
    function getRelativeTime(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      
      const seconds = Math.floor(diff / 1000);
      const minutes = Math.floor(seconds / 60);
      const hours = Math.floor(minutes / 60);
      const days = Math.floor(hours / 24);
      
      if (seconds < 60) return 'åˆšåˆš';
      if (minutes < 60) return `${minutes}åˆ†é’Ÿå‰`;
      if (hours < 24) return `${hours}å°æ—¶å‰`;
      if (days < 7) return `${days}å¤©å‰`;
      
      const date = new Date(timestamp);
      return date.toLocaleDateString('zh-CN');
    }

    // æ¸²æŸ“å…¬å‘Šåˆ—è¡¨
    function renderAnnouncements() {
      const container = document.getElementById('announcementContainer');
      const emptyState = document.getElementById('emptyAnnouncement');
      
      if (announcements.length === 0) {
        container.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      let html = '';
      // æ˜¾ç¤ºæœ€æ–°çš„5æ¡å…¬å‘Š
      const displayAnnouncements = announcements.slice(0, 5);
      
      displayAnnouncements.forEach((announcement, index) => {
        const relativeTime = getRelativeTime(announcement.timestamp);
        html += `
          <div class="bg-gradient-to-r from-primary/5 to-transparent border-l-4 border-primary p-3 rounded-lg animate-fadeIn" style="animation-delay: ${index * 0.1}s">
            <div class="flex items-start gap-2">
              <i class="fa fa-volume-up text-primary mt-1 flex-shrink-0"></i>
              <div class="flex-1 min-w-0">
                <p class="text-sm text-neutral-800 break-words">${escapeHtml(announcement.content)}</p>
                <div class="flex items-center gap-2 mt-2">
                  <span class="text-xs text-neutral-500">
                    <i class="fa fa-clock-o mr-1"></i>${relativeTime}
                  </span>
                </div>
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // æ¸²æŸ“å…¬å‘Šå†å²åˆ—è¡¨ï¼ˆåå°ç®¡ç†ï¼‰
    function renderAnnouncementHistory() {
      const container = document.getElementById('announcementHistoryList');
      const countElement = document.getElementById('announcementCount');
      
      countElement.textContent = `(${announcements.length}æ¡)`;
      
      if (announcements.length === 0) {
        container.innerHTML = '<div class="text-center text-neutral-400 py-4 text-sm">æš‚æ— å†å²å…¬å‘Š</div>';
        return;
      }
      
      let html = '';
      announcements.forEach((announcement, index) => {
        const date = new Date(announcement.timestamp);
        const dateStr = date.toLocaleString('zh-CN', {
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        html += `
          <div class="bg-white p-3 rounded-lg border border-neutral-200 hover:border-primary/50 transition-colors">
            <div class="flex justify-between items-start gap-2">
              <div class="flex-1 min-w-0">
                <p class="text-xs sm:text-sm text-neutral-800 break-words">${escapeHtml(announcement.content)}</p>
                <p class="text-xs text-neutral-500 mt-1">
                  <i class="fa fa-clock-o mr-1"></i>${dateStr}
                </p>
              </div>
              <button class="delete-announcement-btn text-primary hover:text-primary/80 transition-colors p-1 flex-shrink-0" data-index="${index}" title="åˆ é™¤">
                <i class="fa fa-trash"></i>
              </button>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html;
      
      // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶
      container.querySelectorAll('.delete-announcement-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const index = parseInt(this.dataset.index);
          deleteAnnouncement(index);
        });
      });
    }

    // HTMLè½¬ä¹‰
    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    // å‘å¸ƒå…¬å‘Š
    function publishAnnouncement() {
      const input = document.getElementById('announcementInput');
      const content = input.value.trim();
      
      if (!content) {
        showMessage('è¯·è¾“å…¥å…¬å‘Šå†…å®¹', 'error');
        input.focus();
        return;
      }
      
      const announcement = {
        id: Date.now(),
        content: content,
        timestamp: Date.now()
      };
      
      // æ·»åŠ åˆ°æ•°ç»„å¼€å¤´
      announcements.unshift(announcement);
      
      // ä¿æŒæœ€å¤š20æ¡
      if (announcements.length > MAX_ANNOUNCEMENTS) {
        announcements = announcements.slice(0, MAX_ANNOUNCEMENTS);
      }
      
      saveAnnouncements();
      renderAnnouncements();
      renderAnnouncementHistory();
      
      // æ¸…ç©ºè¾“å…¥æ¡†
      input.value = '';
      updateCharCount();
      
      showMessage('å…¬å‘Šå‘å¸ƒæˆåŠŸ', 'success');
    }

    // åˆ é™¤å•æ¡å…¬å‘Š
    function deleteAnnouncement(index) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡å…¬å‘Šå—ï¼Ÿ')) {
        announcements.splice(index, 1);
        saveAnnouncements();
        renderAnnouncements();
        renderAnnouncementHistory();
        showMessage('å…¬å‘Šå·²åˆ é™¤', 'success');
      }
    }

    // æ¸…é™¤æ‰€æœ‰å…¬å‘Š
    function clearAllAnnouncements() {
      if (announcements.length === 0) {
        showMessage('æš‚æ— å†å²å…¬å‘Š', 'info');
        return;
      }
      
      if (confirm(`ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰${announcements.length}æ¡å†å²å…¬å‘Šå—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ï¼`)) {
        announcements = [];
        saveAnnouncements();
        renderAnnouncements();
        renderAnnouncementHistory();
        showMessage('å·²æ¸…é™¤æ‰€æœ‰å†å²å…¬å‘Š', 'success');
      }
    }

    // æ›´æ–°å­—ç¬¦è®¡æ•°
    function updateCharCount() {
      const input = document.getElementById('announcementInput');
      const count = document.getElementById('announcementCharCount');
      count.textContent = `${input.value.length}/500`;
    }

    // åˆå§‹æ•°æ®
    const defaultTeamData = [
      { id: 1, name: "é”€å”®ä¸€éƒ¨", slogan: "å‹‡æ”€é«˜å³°ï¼Œä¸šç»©ä¸ºç‹", channel: "ç›´æ’­éƒ¨", rate: 128.30, rankChange: 0, avatar: "" },
      { id: 2, name: "é”€å”®äºŒéƒ¨", slogan: "å›¢ç»“åä½œï¼Œå…±åˆ›è¾‰ç…Œ", channel: "è§†é¢‘éƒ¨", rate: 115.60, rankChange: 2, avatar: "" },
      { id: 3, name: "é”€å”®ä¸‰éƒ¨", slogan: "ç²¾ç›Šæ±‚ç²¾ï¼Œè¿½æ±‚å“è¶Š", channel: "å“ç‰Œéƒ¨", rate: 102.40, rankChange: -1, avatar: "" },
      { id: 4, name: "åŒºåŸŸå›¢é˜ŸA", slogan: "ä¸“æ³¨æœåŠ¡ï¼Œç”¨å¿ƒç»è¥", channel: "è®¾è®¡éƒ¨", rate: 89.50, rankChange: 1, avatar: "" },
      { id: 5, name: "åŒºåŸŸå›¢é˜ŸB", slogan: "å¼€æ‹“åˆ›æ–°ï¼Œæ°¸ä¸æ­¢æ­¥", channel: "å¹³å°è¿è¥", rate: 78.20, rankChange: -2, avatar: "" },
      { id: 6, name: "ç”µå•†å›¢é˜Ÿ", slogan: "è¯šä¿¡ä¸ºæœ¬ï¼Œè´¨é‡ç¬¬ä¸€", channel: "å®¢æœéƒ¨", rate: 67.80, rankChange: 0, avatar: "" },
      { id: 7, name: "æ–°åª’ä½“å›¢é˜Ÿ", slogan: "å†…å®¹ä¸ºç‹ï¼Œæµé‡è‡³ä¸Š", channel: "ç›´æ’­éƒ¨", rate: 56.40, rankChange: 3, avatar: "" },
      { id: 8, name: "åˆä½œå›¢é˜Ÿ", slogan: "åˆä½œå…±èµ¢ï¼Œå…±åŒå‘å±•", channel: "è§†é¢‘éƒ¨", rate: 45.20, rankChange: -1, avatar: "" }
    ];

    // è·å–å›¢é˜Ÿé¦–å­—æ¯ç¼©å†™ï¼ˆç”¨äºé»˜è®¤å¤´åƒï¼‰
    function getTeamInitials(name) {
      if (!name) return '?';
      // å¦‚æœæ˜¯ä¸­æ–‡ï¼Œå–å‰ä¸¤ä¸ªå­—
      if (/[\u4e00-\u9fa5]/.test(name)) {
        return name.substring(0, 2);
      }
      // å¦‚æœæ˜¯è‹±æ–‡ï¼Œå–é¦–å­—æ¯
      const words = name.trim().split(/\s+/);
      if (words.length >= 2) {
        return (words[0][0] + words[1][0]).toUpperCase();
      }
      return name.substring(0, 2).toUpperCase();
    }

    // ç”Ÿæˆå¤´åƒHTML
    function getAvatarHTML(team, size = 'md') {
      const sizes = {
        sm: 'w-8 h-8 text-xs',
        md: 'w-10 h-10 text-sm',
        lg: 'w-12 h-12 text-base',
        xl: 'w-16 h-16 text-lg'
      };
      
      const sizeClass = sizes[size] || sizes.md;
      
      if (team.avatar && team.avatar.trim() !== '') {
        return `
          <div class="${sizeClass} rounded-full overflow-hidden flex-shrink-0 border-2 border-white shadow-sm">
            <img src="${team.avatar}" alt="${team.name}" class="w-full h-full object-cover" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
            <div class="w-full h-full bg-gradient-to-br from-primary to-secondary flex items-center justify-center font-semibold text-white" style="display:none;">
              ${getTeamInitials(team.name)}
            </div>
          </div>
        `;
      } else {
        // é»˜è®¤å¤´åƒ - ä½¿ç”¨æ¸å˜èƒŒæ™¯å’Œé¦–å­—æ¯
        const gradients = [
          'from-red-400 to-pink-500',
          'from-blue-400 to-indigo-500',
          'from-green-400 to-teal-500',
          'from-yellow-400 to-orange-500',
          'from-purple-400 to-pink-500',
          'from-cyan-400 to-blue-500'
        ];
        const gradient = gradients[team.id % gradients.length];
        
        return `
          <div class="${sizeClass} rounded-full bg-gradient-to-br ${gradient} flex items-center justify-center font-semibold text-white flex-shrink-0 border-2 border-white shadow-sm">
            ${getTeamInitials(team.name)}
          </div>
        `;
      }
    }

    // å·¥å…·å‡½æ•°ï¼šé˜²æŠ–
    function debounce(func, wait) {
      let timeout;
      return function(...args) {
        clearTimeout(timeout);
        timeout = setTimeout(() => func.apply(this, args), wait);
      };
    }

    // å·¥å…·å‡½æ•°ï¼šæ˜¾ç¤ºæ¶ˆæ¯ - ä¼˜åŒ–ç§»åŠ¨ç«¯æ˜¾ç¤º
    function showMessage(message, type = 'success') {
      const container = document.getElementById('messageContainer');
      const messageDiv = document.createElement('div');
      
      const bgColor = type === 'success' ? 'bg-success' : type === 'error' ? 'bg-primary' : 'bg-secondary';
      messageDiv.className = `${bgColor} text-white px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 animate-slideUp text-sm`;
      
      const icon = type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle';
      messageDiv.innerHTML = `
        <i class="fa fa-${icon} flex-shrink-0"></i>
        <span class="flex-1">${message}</span>
        <button onclick="this.parentElement.remove()" class="ml-2 hover:opacity-80">
          <i class="fa fa-times"></i>
        </button>
      `;
      
      container.appendChild(messageDiv);
      
      setTimeout(() => {
        messageDiv.style.opacity = '0';
        messageDiv.style.transform = 'translateX(100%)';
        setTimeout(() => messageDiv.remove(), 300);
      }, 3000);
    }

    // åŠ è½½å›¢é˜Ÿæ•°æ®
    function loadTeamData() {
      const savedData = localStorage.getItem('teamData');
      if (savedData) {
        teamData = JSON.parse(savedData);
      } else {
        teamData = [...defaultTeamData];
        saveTeamData();
      }
    }

    // ä¿å­˜å›¢é˜Ÿæ•°æ®
    function saveTeamData() {
      localStorage.setItem('teamData', JSON.stringify(teamData));
    }

    // æ¸²æŸ“å‰ä¸‰å - ä¼˜åŒ–å¸ƒå±€ï¼Œçªå‡ºç¬¬ä¸€åï¼Œä¿®å¤å¥–æ¯è£å‰ªï¼Œåº•éƒ¨å¯¹é½ï¼Œæ·»åŠ å£å·æ˜¾ç¤º
    function renderTopThree() {
      const sortedTeams = [...teamData].sort((a, b) => b.rate - a.rate);
      const top3 = sortedTeams.slice(0, 3);
      const container = document.getElementById('topThreeContainer');
      
      // ç¬¬äºŒå - ä¸­ç­‰é«˜åº¦ï¼Œåº•éƒ¨å¯¹é½
      const secondPlace = top3[1] ? `
        <div class="relative order-1 sm:order-1 animate-fadeIn transform sm:scale-90" style="animation-delay: 0.1s">
          <div class="bg-gradient-to-br from-neutral-100 to-neutral-200 rounded-xl p-4 sm:p-5 text-center card-hover border-2 border-neutral-300 relative" style="margin-top: 18px;">
            <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-br from-neutral-300 to-neutral-400 text-white w-9 h-9 sm:w-10 sm:h-10 rounded-full flex items-center justify-center font-bold text-sm sm:text-base shadow-lg z-20">
              2
            </div>
            <div class="mt-5 sm:mt-6">
              <div class="flex justify-center mb-3">
                ${getAvatarHTML(top3[1], 'md')}
              </div>
              <h3 class="font-semibold text-sm sm:text-base text-neutral-700 truncate">${top3[1].name}</h3>
              ${top3[1].slogan ? `<p class="text-xs text-neutral-600 italic truncate mt-1 px-2"><i class="fa fa-quote-left mr-1"></i>${top3[1].slogan}</p>` : ''}
              <div class="mt-3">
                <span class="text-xl sm:text-2xl font-bold text-neutral-700">${top3[1].rate.toFixed(2)}</span>
                <span class="text-neutral-500 text-xs">%</span>
              </div>
              <div class="mt-3 w-full h-1.5 bg-neutral-300 rounded-full overflow-hidden">
                <div class="h-full bg-gradient-to-r from-neutral-400 to-neutral-500 rounded-full transition-all duration-1000" style="width: ${Math.min(top3[1].rate, 100)}%"></div>
              </div>
            </div>
          </div>
        </div>
      ` : '';
      
      // ç¬¬ä¸€å - é€‚åº¦æ”¾å¤§ï¼Œçªå‡ºæ˜¾ç¤ºï¼Œä¿®å¤å¥–æ¯è£å‰ª
      const firstPlace = top3[0] ? `
        <div class="relative order-2 sm:order-2 transform sm:scale-105 animate-fadeIn" style="animation-delay: 0s; z-index: 30;">
          <div class="bg-gradient-to-br from-secondary to-secondary/90 rounded-xl p-5 sm:p-6 text-center card-hover shadow-2xl border-4 border-secondary medal-shine relative overflow-visible">
            <div class="absolute -top-7 left-1/2 transform -translate-x-1/2 bg-gradient-to-br from-secondary to-amber-600 text-white w-14 h-14 sm:w-16 sm:h-16 rounded-full flex items-center justify-center font-bold text-xl sm:text-2xl shadow-2xl" style="z-index: 40;">
              <i class="fa fa-trophy"></i>
            </div>
            <div class="mt-8 sm:mt-10">
              <div class="flex justify-center mb-3">
                ${getAvatarHTML(top3[0], 'lg')}
              </div>
              <h3 class="font-bold text-lg sm:text-xl text-white truncate">${top3[0].name}</h3>
              ${top3[0].slogan ? `<p class="text-xs sm:text-sm text-white/80 italic truncate mt-1 px-2"><i class="fa fa-quote-left mr-1"></i>${top3[0].slogan}</p>` : ''}
              <div class="mt-3 sm:mt-4">
                <span class="text-3xl sm:text-4xl font-bold text-white">${top3[0].rate.toFixed(2)}</span>
                <span class="text-white/90 text-base">%</span>
              </div>
              <div class="mt-3 w-full h-2.5 bg-white/30 rounded-full overflow-hidden">
                <div class="h-full bg-white rounded-full transition-all duration-1000 shadow-lg" style="width: ${Math.min(top3[0].rate, 100)}%"></div>
              </div>
            </div>
          </div>
        </div>
      ` : '';
      
      // ç¬¬ä¸‰å - è¾ƒä½é«˜åº¦ï¼Œåº•éƒ¨å¯¹é½
      const thirdPlace = top3[2] ? `
        <div class="relative order-3 sm:order-3 animate-fadeIn transform sm:scale-90" style="animation-delay: 0.2s">
          <div class="bg-gradient-to-br from-amber-600 to-amber-700 rounded-xl p-4 sm:p-5 text-center card-hover border-2 border-amber-700 relative" style="margin-top: 26px;">
            <div class="absolute -top-4 left-1/2 transform -translate-x-1/2 bg-gradient-to-br from-amber-700 to-amber-800 text-white w-9 h-9 sm:w-10 sm:h-10 rounded-full flex items-center justify-center font-bold text-sm sm:text-base shadow-lg z-20">
              3
            </div>
            <div class="mt-5 sm:mt-6">
              <div class="flex justify-center mb-3">
                ${getAvatarHTML(top3[2], 'md')}
              </div>
              <h3 class="font-semibold text-sm sm:text-base text-white truncate">${top3[2].name}</h3>
              ${top3[2].slogan ? `<p class="text-xs text-white/80 italic truncate mt-1 px-2"><i class="fa fa-quote-left mr-1"></i>${top3[2].slogan}</p>` : ''}
              <div class="mt-3">
                <span class="text-xl sm:text-2xl font-bold text-white">${top3[2].rate.toFixed(2)}</span>
                <span class="text-white/90 text-xs">%</span>
              </div>
              <div class="mt-3 w-full h-1.5 bg-white/30 rounded-full overflow-hidden">
                <div class="h-full bg-white rounded-full transition-all duration-1000" style="width: ${Math.min(top3[2].rate, 100)}%"></div>
              </div>
            </div>
          </div>
        </div>
      ` : '';
      
      container.innerHTML = secondPlace + firstPlace + thirdPlace;
    }

    // æ¸²æŸ“æ’è¡Œæ¦œåˆ—è¡¨ - ä¼˜åŒ–æ’ç‰ˆå’Œäº¤äº’ï¼Œæ·»åŠ å¤´åƒï¼Œä¼˜åŒ–é—´è·å¸ƒå±€
    function renderRankingList() {
      const sortedTeams = [...teamData].sort((a, b) => b.rate - a.rate);
      const container = document.getElementById('rankingList');
      
      let html = '';
      sortedTeams.slice(3).forEach((team, index) => {
        const rank = index + 4;
        const changeIcon = team.rankChange > 0 ? 'arrow-up' : team.rankChange < 0 ? 'arrow-down' : 'minus';
        const changeColor = team.rankChange > 0 ? 'text-success' : team.rankChange < 0 ? 'text-primary' : 'text-neutral-400';
        const rateColor = team.rate >= 100 ? 'text-success' : team.rate >= 80 ? 'text-secondary' : 'text-neutral-700';
        const slogan = team.slogan || '';
        
        html += `
          <div class="rank-item flex items-center justify-between p-4 sm:p-5 bg-neutral-50 hover:bg-neutral-100 rounded-lg border border-transparent hover:border-primary/20 transition-all" style="animation: fadeIn 0.3s ease-in ${index * 0.05}s both">
            <div class="flex items-center gap-3 sm:gap-4 flex-1 min-w-0">
              <span class="text-xl sm:text-2xl font-bold text-neutral-400 w-7 sm:w-9 flex-shrink-0 text-center">${rank}</span>
              <div class="flex-shrink-0">
                ${getAvatarHTML(team, 'sm')}
              </div>
              <div class="flex-1 min-w-0">
                <h4 class="font-semibold text-sm sm:text-base text-neutral-800 truncate">${team.name}</h4>
                ${slogan ? `<p class="text-xs sm:text-sm text-neutral-600 italic truncate mt-0.5"><i class="fa fa-quote-left mr-1 text-xxs"></i>${slogan}</p>` : ''}
                <p class="text-xs sm:text-sm text-neutral-500 truncate ${slogan ? '' : 'mt-0.5'}">
                  <i class="fa fa-map-marker mr-1"></i>${team.channel}
                </p>
              </div>
            </div>
            <div class="flex items-center gap-4 sm:gap-6 flex-shrink-0 ml-3">
              <div class="text-right">
                <span class="text-lg sm:text-xl font-bold ${rateColor} whitespace-nowrap">${team.rate.toFixed(2)}%</span>
                <div class="w-20 sm:w-24 h-1.5 sm:h-2 bg-neutral-200 rounded-full mt-1.5">
                  <div class="h-full bg-gradient-to-r from-primary to-primary/80 rounded-full transition-all duration-1000" style="width: ${Math.min(team.rate, 100)}%"></div>
                </div>
              </div>
              <div class="${changeColor} flex items-center gap-1 w-10 sm:w-12 justify-center flex-shrink-0">
                <i class="fa fa-${changeIcon} text-xs sm:text-sm"></i>
                <span class="text-xs sm:text-sm font-medium">${Math.abs(team.rankChange)}</span>
              </div>
            </div>
          </div>
        `;
      });
      
      container.innerHTML = html || '<div class="text-center text-neutral-400 py-8">æš‚æ— æ›´å¤šæ’åæ•°æ®</div>';
      
      // æ›´æ–°å‰ä¸‰åæ˜¾ç¤º
      renderTopThree();
      
      // æ›´æ–°å›¢é˜Ÿæ•°é‡
      document.getElementById('teamCount').textContent = teamData.length;
      
      // æ›´æ–°æœ€ä½³å›¢é˜Ÿ
      renderBestTeams();
    }

    // æ¸²æŸ“æœ€ä½³å›¢é˜Ÿ - ä¼˜åŒ–æ˜¾ç¤º
    function renderBestTeams() {
      const sortedTeams = [...teamData].sort((a, b) => b.rate - a.rate);
      const container = document.getElementById('bestTeamsContainer');
      const emptyState = document.getElementById('emptyBestTeams');
      const titleElement = document.getElementById('bestTeamTitle');
      
      // æ›´æ–°æ¿å—æ ‡é¢˜
      const savedData = localStorage.getItem('awards');
      if (savedData) {
        const data = JSON.parse(savedData);
        titleElement.textContent = data.blockTitle || DEFAULT_AWARD_TITLE;
      } else {
        titleElement.textContent = DEFAULT_AWARD_TITLE;
      }
      
      if (awards.length === 0) {
        container.classList.add('hidden');
        emptyState.classList.remove('hidden');
        return;
      }
      
      container.classList.remove('hidden');
      emptyState.classList.add('hidden');
      
      let html = '';
      const icons = getAwardIcons();
      
      awards.forEach((award, index) => {
        let team;
        
        // å¦‚æœæŒ‡å®šäº†å›¢é˜ŸIDï¼Œä½¿ç”¨æŒ‡å®šçš„å›¢é˜Ÿ
        if (award.teamId) {
          team = teamData.find(t => t.id === award.teamId);
        }
        
        // å¦åˆ™æŒ‰æ’åè‡ªåŠ¨åˆ†é…
        if (!team && sortedTeams[index]) {
          team = sortedTeams[index];
        }
        
        if (!team) return;
        
        const iconObj = icons.find(i => i.value === award.icon) || icons[0];
        
        html += `
          <div class="flex items-center justify-between p-3 bg-neutral-50 rounded-lg hover:bg-neutral-100 transition-colors">
            <div class="flex items-center gap-3 flex-1 min-w-0">
              <div class="${award.bg} p-2 rounded-full ${award.color} flex-shrink-0">
                <i class="fa ${iconObj.icon} text-base sm:text-lg"></i>
              </div>
              <div class="flex-1 min-w-0">
                <div class="flex items-center gap-2">
                  <p class="font-medium text-sm sm:text-base text-neutral-800 truncate">${team.name}</p>
                  <span class="text-xs px-2 py-0.5 rounded-full ${award.bg} ${award.color} whitespace-nowrap">
                    ${award.name}
                  </span>
                </div>
                <p class="text-xs sm:text-sm text-neutral-500 truncate">${team.channel}</p>
              </div>
            </div>
            <span class="font-bold text-sm sm:text-base text-neutral-800 ml-2">${team.rate.toFixed(2)}%</span>
          </div>
        `;
      });
      
      container.innerHTML = html;
    }

    // æ¸²æŸ“å¯ç¼–è¾‘è¡¨æ ¼ - ä¼˜åŒ–ç§»åŠ¨ç«¯ï¼Œæ·»åŠ å¤´åƒä¸Šä¼ å’Œå£å·ç¼–è¾‘
    function renderEditableTable() {
      const sortedTeams = [...teamData].sort((a, b) => b.rate - a.rate);
      const tbody = document.getElementById('editableTeamTable');
      
      let html = '';
      sortedTeams.forEach((team, index) => {
        html += `
          <tr data-id="${team.id}" class="hover:bg-neutral-50 transition-colors">
            <td class="px-3 sm:px-4 py-2 sm:py-3 text-xs sm:text-sm font-medium">${index + 1}</td>
            <td class="px-3 sm:px-4 py-2 sm:py-3">
              <div class="flex flex-col gap-2">
                <div class="flex items-center gap-2">
                  ${getAvatarHTML(team, 'sm')}
                  <div class="flex flex-col gap-1">
                    <input 
                      type="file" 
                      accept="image/jpeg,image/png,image/gif,image/webp" 
                      class="team-avatar-upload hidden" 
                      data-team-id="${team.id}"
                      id="avatarUpload_${team.id}"
                    >
                    <label 
                      for="avatarUpload_${team.id}" 
                      class="cursor-pointer text-xs text-primary hover:text-primary/80 flex items-center gap-1"
                      title="ä¸Šä¼ å›¾ç‰‡"
                    >
                      <i class="fa fa-upload"></i>
                      <span>ä¸Šä¼ </span>
                    </label>
                    ${team.avatar ? `
                      <button 
                        class="delete-avatar-btn text-xs text-neutral-500 hover:text-primary flex items-center gap-1" 
                        data-team-id="${team.id}"
                        title="åˆ é™¤å¤´åƒ"
                      >
                        <i class="fa fa-times"></i>
                        <span>åˆ é™¤</span>
                      </button>
                    ` : ''}
                  </div>
                </div>
              </div>
            </td>
            <td class="px-3 sm:px-4 py-2 sm:py-3">
              <input type="text" value="${team.name}" class="team-name-input input-field text-xs sm:text-sm py-1 min-w-0" data-field="name" placeholder="å›¢é˜Ÿåç§°">
            </td>
            <td class="px-3 sm:px-4 py-2 sm:py-3">
              <input type="text" value="${team.slogan || ''}" class="team-slogan-input input-field text-xs sm:text-sm py-1 min-w-0" data-field="slogan" placeholder="è¾“å…¥å›¢é˜Ÿå£å·">
            </td>
            <td class="px-3 sm:px-4 py-2 sm:py-3">
              <div class="flex flex-col gap-1">
                <select class="team-channel-select input-field text-xs sm:text-sm py-1 min-w-0" data-field="channel" data-team-id="${team.id}">
                  <option value="ç›´æ’­éƒ¨" ${team.channel === 'ç›´æ’­éƒ¨' ? 'selected' : ''}>ç›´æ’­éƒ¨</option>
                  <option value="è§†é¢‘éƒ¨" ${team.channel === 'è§†é¢‘éƒ¨' ? 'selected' : ''}>è§†é¢‘éƒ¨</option>
                  <option value="å“ç‰Œéƒ¨" ${team.channel === 'å“ç‰Œéƒ¨' ? 'selected' : ''}>å“ç‰Œéƒ¨</option>
                  <option value="è®¾è®¡éƒ¨" ${team.channel === 'è®¾è®¡éƒ¨' ? 'selected' : ''}>è®¾è®¡éƒ¨</option>
                  <option value="å¹³å°è¿è¥" ${team.channel === 'å¹³å°è¿è¥' ? 'selected' : ''}>å¹³å°è¿è¥</option>
                  <option value="å®¢æœéƒ¨" ${team.channel === 'å®¢æœéƒ¨' ? 'selected' : ''}>å®¢æœéƒ¨</option>
                  <option value="å•†åŠ¡éƒ¨" ${team.channel === 'å•†åŠ¡éƒ¨' ? 'selected' : ''}>å•†åŠ¡éƒ¨</option>
                  <option value="__custom__" ${!['\u76f4\u64ad\u90e8','\u89c6\u9891\u90e8','\u54c1\u724c\u90e8','\u8bbe\u8ba1\u90e8','\u5e73\u53f0\u8fd0\u8425','\u5ba2\u670d\u90e8','\u5546\u52a1\u90e8'].includes(team.channel) ? 'selected' : ''}>è‡ªå®šä¹‰...</option>
                </select>
                <input 
                  type="text" 
                  class="team-custom-channel-input input-field text-xs sm:text-sm py-1 min-w-0 ${['\u76f4\u64ad\u90e8','\u89c6\u9891\u90e8','\u54c1\u724c\u90e8','\u8bbe\u8ba1\u90e8','\u5e73\u53f0\u8fd0\u8425','\u5ba2\u670d\u90e8','\u5546\u52a1\u90e8'].includes(team.channel) ? 'hidden' : ''}" 
                  value="${!['\u76f4\u64ad\u90e8','\u89c6\u9891\u90e8','\u54c1\u724c\u90e8','\u8bbe\u8ba1\u90e8','\u5e73\u53f0\u8fd0\u8425','\u5ba2\u670d\u90e8','\u5546\u52a1\u90e8'].includes(team.channel) ? team.channel : ''}" 
                  placeholder="è¯·è¾“å…¥è‡ªå®šä¹‰æ¸ é“åç§°"
                  data-team-id="${team.id}"
                >
              </div>
            </td>
            <td class="px-3 sm:px-4 py-2 sm:py-3">
              <input type="number" step="0.01" value="${team.rate.toFixed(2)}" class="team-rate-input input-field text-xs sm:text-sm py-1 w-20 sm:w-24" data-field="rate">
            </td>
            <td class="px-3 sm:px-4 py-2 sm:py-3">
              <input type="number" value="${team.rankChange}" class="team-rankchange-input input-field text-xs sm:text-sm py-1 w-16 sm:w-20" data-field="rankChange">
            </td>
            <td class="px-3 sm:px-4 py-2 sm:py-3 text-right">
              <button class="delete-team-btn text-primary hover:text-primary/80 transition-colors p-1" data-id="${team.id}" title="åˆ é™¤">
                <i class="fa fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      });
      
      tbody.innerHTML = html;
      
      // è®¾ç½®è¡¨æ ¼äº‹ä»¶ç›‘å¬å™¨
      setupTableEventListeners();
    }

    // è®¾ç½®è¡¨æ ¼äº‹ä»¶ç›‘å¬å™¨
    function setupTableEventListeners() {
      const tbody = document.getElementById('editableTeamTable');
      
      // ç§»é™¤æ—§çš„ç›‘å¬å™¨
      tbody.replaceWith(tbody.cloneNode(true));
      const newTbody = document.getElementById('editableTeamTable');
      
      // æ·»åŠ è¾“å…¥äº‹ä»¶ç›‘å¬å™¨
      newTbody.addEventListener('input', debounce(function(e) {
        const input = e.target;
        if (input.matches('.team-name-input, .team-rate-input, .team-rankchange-input, .team-slogan-input')) {
          const row = input.closest('tr');
          const teamId = parseInt(row.dataset.id);
          const field = input.dataset.field;
          let value = input.value;
          
          if (field === 'rate') {
            value = Math.round((parseFloat(value) || 0) * 100) / 100;
          } else if (field === 'rankChange') {
            value = parseFloat(value) || 0;
          }
          
          updateTeamData(teamId, field, value);
        }
        
        // å¤„ç†è‡ªå®šä¹‰æ¸ é“è¾“å…¥
        if (input.matches('.team-custom-channel-input')) {
          const teamId = parseInt(input.dataset.teamId);
          const customChannel = input.value.trim();
          if (customChannel) {
            updateTeamData(teamId, 'channel', customChannel);
          }
        }
      }, 500));
      
      // æ·»åŠ æ¸ é“é€‰æ‹©å˜åŒ–äº‹ä»¶
      newTbody.addEventListener('change', function(e) {
        // å¤„ç†æ¸ é“ä¸‹æ‹‰é€‰æ‹©
        if (e.target.matches('.team-channel-select')) {
          const select = e.target;
          const teamId = parseInt(select.dataset.teamId);
          const row = select.closest('tr');
          const customInput = row.querySelector('.team-custom-channel-input');
          
          if (select.value === '__custom__') {
            // æ˜¾ç¤ºè‡ªå®šä¹‰è¾“å…¥æ¡†
            customInput.classList.remove('hidden');
            customInput.focus();
          } else {
            // éšè—è‡ªå®šä¹‰è¾“å…¥æ¡†ï¼Œä½¿ç”¨é¢„è®¾æ¸ é“
            customInput.classList.add('hidden');
            customInput.value = '';
            updateTeamData(teamId, 'channel', select.value);
          }
        }
        
        // å¤„ç†å¤´åƒä¸Šä¼ 
        if (e.target.matches('.team-avatar-upload')) {
          const input = e.target;
          const teamId = parseInt(input.dataset.teamId);
          const file = input.files[0];
          
          if (file) {
            // éªŒè¯æ–‡ä»¶ç±»å‹
            const validTypes = ['image/jpeg', 'image/png', 'image/gif', 'image/webp'];
            if (!validTypes.includes(file.type)) {
              showMessage('è¯·ä¸Šä¼ æœ‰æ•ˆçš„å›¾ç‰‡æ–‡ä»¶ï¼ˆjpgã€pngã€gifã€webpï¼‰', 'error');
              input.value = '';
              return;
            }
            
            // éªŒè¯æ–‡ä»¶å¤§å°ï¼ˆ2MBï¼‰
            if (file.size > 2 * 1024 * 1024) {
              showMessage('å›¾ç‰‡å¤§å°ä¸èƒ½è¶…è¿‡2MB', 'error');
              input.value = '';
              return;
            }
            
            // è¯»å–æ–‡ä»¶å¹¶è½¬æ¢ä¸ºBase64
            const reader = new FileReader();
            reader.onload = function(event) {
              const base64Data = event.target.result;
              updateTeamData(teamId, 'avatar', base64Data);
              showMessage('å¤´åƒä¸Šä¼ æˆåŠŸ', 'success');
            };
            reader.onerror = function() {
              showMessage('å›¾ç‰‡è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
              input.value = '';
            };
            reader.readAsDataURL(file);
          }
        }
      });
      
      // æ·»åŠ åˆ é™¤æŒ‰é’®äº‹ä»¶ç›‘å¬å™¨
      newTbody.addEventListener('click', function(e) {
        // åˆ é™¤å›¢é˜Ÿ
        if (e.target.closest('.delete-team-btn')) {
          const btn = e.target.closest('.delete-team-btn');
          const teamId = parseInt(btn.dataset.id);
          deleteTeam(teamId);
        }
        
        // åˆ é™¤å¤´åƒ
        if (e.target.closest('.delete-avatar-btn')) {
          const btn = e.target.closest('.delete-avatar-btn');
          const teamId = parseInt(btn.dataset.teamId);
          if (confirm('ç¡®å®šè¦åˆ é™¤è¯¥å¤´åƒå¹¶æ¢å¤ä¸ºé»˜è®¤å¤´åƒå—ï¼Ÿ')) {
            updateTeamData(teamId, 'avatar', '');
            showMessage('å·²æ¢å¤ä¸ºé»˜è®¤å¤´åƒ', 'success');
          }
        }
      });
    }

    // æ›´æ–°å›¢é˜Ÿæ•°æ®
    function updateTeamData(teamId, field, value) {
      const teamIndex = teamData.findIndex(team => team.id === teamId);
      if (teamIndex !== -1) {
        // å¦‚æœæ˜¯è¾¾æˆç‡å­—æ®µï¼Œç¡®ä¿ä¿ç•™ä¸¤ä½å°æ•°
        if (field === 'rate') {
          value = Math.round((parseFloat(value) || 0) * 100) / 100;
        }
        
        teamData[teamIndex][field] = value;
        
        if (field === 'rate') {
          // é‡æ–°æ’åºå¹¶æ›´æ–°æ’åå˜åŠ¨
          const oldRanks = {};
          teamData.forEach((team, index) => {
            oldRanks[team.id] = index + 1;
          });
          
          teamData.sort((a, b) => b.rate - a.rate);
          
          teamData.forEach((team, index) => {
            const newRank = index + 1;
            const oldRank = oldRanks[team.id];
            team.rankChange = oldRank - newRank;
          });
          
          renderRankingList();
          updateOverallRate();
          updateCharts();
        } else if (field === 'avatar' || field === 'name' || field === 'slogan') {
          // å¤´åƒã€åç§°æˆ–å£å·æ›´æ”¹æ—¶ï¼Œé‡æ–°æ¸²æŸ“æ’è¡Œæ¦œå’Œè¡¨æ ¼
          renderRankingList();
          renderEditableTable();
        }
        
        saveTeamData();
        showMessage('æ•°æ®å·²æ›´æ–°', 'success');
      }
    }

    // åˆ é™¤å›¢é˜Ÿ
    function deleteTeam(teamId) {
      if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå›¢é˜Ÿå—ï¼Ÿ')) {
        teamData = teamData.filter(team => team.id !== teamId);
        
        // åˆ é™¤å¯¹åº”çš„è¶‹åŠ¿æ•°æ®
        delete trendData[teamId];
        saveTrendData();
        
        saveTeamData();
        renderRankingList();
        renderEditableTable();
        updateOverallRate();
        updateCharts();
        renderTrendDataTable(); // æ›´æ–°è¶‹åŠ¿æ•°æ®è¡¨
        showMessage('å›¢é˜Ÿå·²åˆ é™¤', 'success');
      }
    }

    // æ·»åŠ æ–°å›¢é˜Ÿ
    function addNewTeam(name, channel, rate) {
      const newId = Math.max(...teamData.map(t => t.id), 0) + 1;
      const newTeam = {
        id: newId,
        name: name,
        slogan: '',
        channel: channel,
        rate: Math.round((parseFloat(rate) || 0) * 100) / 100,
        rankChange: 0,
        avatar: ''
      };
      
      teamData.push(newTeam);
      
      // ä¸ºæ–°å›¢é˜Ÿæ·»åŠ è¶‹åŠ¿æ•°æ®
      trendData[newId] = generateTrendDataForTeam(newTeam.rate);
      saveTrendData();
      
      saveTeamData();
      renderRankingList();
      renderEditableTable();
      updateOverallRate();
      updateCharts();
      renderTrendDataTable(); // æ›´æ–°è¶‹åŠ¿æ•°æ®è¡¨
      showMessage('æ–°å›¢é˜Ÿå·²æ·»åŠ ', 'success');
    }

    // æ›´æ–°æ€»ä½“è¾¾æˆç‡ - æ·»åŠ åŠ¨ç”»
    function updateOverallRate() {
      const totalRate = teamData.reduce((sum, team) => sum + team.rate, 0);
      const avgRate = (totalRate / teamData.length).toFixed(2);
      
      const rateElement = document.getElementById('overallRate');
      const currentRate = parseFloat(rateElement.textContent) || 0;
      animateNumber(rateElement, currentRate, avgRate, 800);
      
      document.getElementById('overallProgressBar').style.width = `${Math.min(avgRate, 100)}%`;
      document.getElementById('avgRate').textContent = avgRate;
      
      const maxRate = Math.max(...teamData.map(t => t.rate));
      document.getElementById('maxRate').textContent = maxRate.toFixed(2);
    }

    // æ•°å­—åŠ¨ç”»
    function animateNumber(element, start, end, duration) {
      const startTime = performance.now();
      const endValue = parseFloat(end);
      const startValue = parseFloat(start);
      
      function update(currentTime) {
        const elapsed = currentTime - startTime;
        const progress = Math.min(elapsed / duration, 1);
        
        const current = startValue + (endValue - startValue) * progress;
        element.textContent = current.toFixed(2);
        
        if (progress < 1) {
          requestAnimationFrame(update);
        }
      }
      
      requestAnimationFrame(update);
    }

    // åˆå§‹åŒ–å›¾è¡¨ - ä¼˜åŒ–é…ç½®
    function initCharts() {
      // é€šç”¨é…ç½®
      const commonOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            labels: {
              font: { size: 11 },
              padding: 10,
              usePointStyle: true
            }
          },
          tooltip: {
            backgroundColor: 'rgba(0, 0, 0, 0.8)',
            padding: 12,
            cornerRadius: 8,
            titleFont: { size: 13 },
            bodyFont: { size: 12 }
          }
        }
      };

      // è¶‹åŠ¿å›¾
      const trendCtx = document.getElementById('trendChart').getContext('2d');
      
      // åŠ¨æ€è·å–å‰ä¸‰åå›¢é˜Ÿçš„è¶‹åŠ¿æ•°æ®
      const top3 = [...teamData].sort((a, b) => b.rate - a.rate).slice(0, 3);
      const initialDatasets = top3.map((team, index) => {
        const data = trendData[team.id] || generateTrendDataForTeam(team.rate);
        return {
          label: team.name,
          data: data,
          borderColor: ['#FF4D4F', '#FAAD14', '#52C41A'][index],
          backgroundColor: [
            'rgba(255, 77, 79, 0.1)',
            'rgba(250, 173, 20, 0.1)',
            'rgba(82, 196, 26, 0.1)'
          ][index],
          tension: 0.4,
          borderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6
        };
      });
      
      charts.trend = new Chart(trendCtx, {
        type: 'line',
        data: {
          labels: trendDates,
          datasets: initialDatasets
        },
        options: {
          ...commonOptions,
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0, 0, 0, 0.05)' },
              ticks: {
                callback: function(value) {
                  return value + '%';
                },
                font: { size: 11 }
              }
            },
            x: {
              grid: { display: false },
              ticks: { font: { size: 11 } }
            }
          },
          plugins: {
            ...commonOptions.plugins,
            legend: { position: 'bottom' }
          }
        }
      });

      // æ¸ é“åˆ†å¸ƒå›¾å·²ç§»é™¤ï¼Œæ›¿æ¢ä¸ºå®æ—¶å…¬å‘Šæ¿å—

      // è¾¾æˆç‡åˆ†å¸ƒå›¾
      const achievementCtx = document.getElementById('achievementChart').getContext('2d');
      charts.achievement = new Chart(achievementCtx, {
        type: 'bar',
        data: {
          labels: ['0-50%', '50-80%', '80-100%', '100%+'],
          datasets: [{
            label: 'å›¢é˜Ÿæ•°é‡',
            data: [2, 3, 2, 3],
            backgroundColor: [
              'rgba(255, 77, 79, 0.8)',
              'rgba(250, 173, 20, 0.8)',
              'rgba(82, 196, 26, 0.8)',
              'rgba(24, 144, 255, 0.8)'
            ],
            borderRadius: 8,
            borderWidth: 0,
            barPercentage: 0.7
          }]
        },
        options: {
          ...commonOptions,
          plugins: {
            ...commonOptions.plugins,
            legend: { display: false }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: { color: 'rgba(0, 0, 0, 0.05)' },
              ticks: {
                stepSize: 1,
                font: { size: 11 }
              }
            },
            x: {
              grid: { display: false },
              ticks: { font: { size: 11 } }
            }
          }
        }
      });
    }

    // æ›´æ–°å›¾è¡¨æ•°æ®
    function updateCharts() {
      // æ¸ é“åˆ†å¸ƒå›¾å·²ç§»é™¤
      
      // æ›´æ–°è¾¾æˆç‡åˆ†å¸ƒ
      const rateRanges = [0, 0, 0, 0];
      teamData.forEach(team => {
        if (team.rate < 50) rateRanges[0]++;
        else if (team.rate < 80) rateRanges[1]++;
        else if (team.rate < 100) rateRanges[2]++;
        else rateRanges[3]++;
      });
      
      if (charts.achievement) {
        charts.achievement.data.datasets[0].data = rateRanges;
        charts.achievement.update('active');
      }
    }

    // è·å–æ´»åŠ¨ç»“æŸæ—¶é—´
    function getActivityEndTime() {
      const savedSettings = localStorage.getItem('systemSettings');
      if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        if (settings.activityEndTime) {
          return settings.activityEndTime;
        }
      }
      return DEFAULT_END_TIME;
    }

    // å€’è®¡æ—¶åŠŸèƒ½
    function startCountdown() {
      // æ¸…é™¤æ—§çš„å®šæ—¶å™¨
      if (countdownTimer) {
        clearInterval(countdownTimer);
      }
      
      const updateCountdown = () => {
        const endTimeStr = getActivityEndTime();
        const targetDate = new Date(endTimeStr).getTime();
        const now = new Date().getTime();
        const distance = targetDate - now;
        
        if (distance < 0) {
          document.getElementById('countdown').innerHTML = '<div class="text-base sm:text-xl font-bold">æ´»åŠ¨å·²ç»“æŸ</div>';
          if (countdownTimer) {
            clearInterval(countdownTimer);
          }
          return;
        }
        
        const days = Math.floor(distance / (1000 * 60 * 60 * 24));
        const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
        const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
        const seconds = Math.floor((distance % (1000 * 60)) / 1000);
        
        document.getElementById('days').textContent = String(days).padStart(2, '0');
        document.getElementById('hours').textContent = String(hours).padStart(2, '0');
        document.getElementById('minutes').textContent = String(minutes).padStart(2, '0');
        document.getElementById('seconds').textContent = String(seconds).padStart(2, '0');
      };
      
      updateCountdown();
      countdownTimer = setInterval(updateCountdown, 1000);
    }

    // è¿œç¨‹æ•°æ®åŠ è½½
    async function loadDataFromAPI() {
      try {
        const res = await fetch('https://raw.githubusercontent.com/ginhoor/DoubleEleven/refs/heads/main/%E6%8E%92%E8%A1%8C%E6%A6%9C%E6%95%B0%E6%8D%AE_2025-10-22T02-57-56.json', { cache: 'no-store' });
        if (!res.ok) throw new Error(`HTTP ${res.status}`);
        const apiData = await res.json();

        if (Array.isArray(apiData.teamData)) {
          teamData = apiData.teamData;
          localStorage.setItem('teamData', JSON.stringify(teamData));
        }
        if (apiData.trendData) {
          trendDates = apiData.trendData.dates || trendDates || [];
          trendData = apiData.trendData.teamData || {};
          saveTrendData();
        }
        if (Array.isArray(apiData.announcements)) {
          announcements = apiData.announcements;
          localStorage.setItem('announcements', JSON.stringify(announcements));
        }
        if (Array.isArray(apiData.awards)) {
          awards = apiData.awards;
          const blockTitle = (apiData.blockTitle || DEFAULT_AWARD_TITLE);
          localStorage.setItem('awards', JSON.stringify({ blockTitle, awards }));
        }
        if (apiData.systemSettings) {
          const settings = { ...apiData.systemSettings, dataSource: 'api' };
          localStorage.setItem('systemSettings', JSON.stringify(settings));
          const dsEl = document.getElementById('dataSource');
          if (dsEl) dsEl.value = 'api';
        }
      } catch (err) {
        console.error('è¿œç¨‹æ•°æ®åŠ è½½å¤±è´¥:', err);
        showMessage('è¿œç¨‹æ•°æ®åŠ è½½å¤±è´¥ï¼Œæš‚ç”¨æœ¬åœ°æ•°æ®', 'error');
      }
    }

    // åˆ·æ–°æ•°æ®
    async function refreshData() {
      const refreshBtn = document.getElementById('refreshBtn');
      refreshBtn.classList.add('animate-spin');
      refreshBtn.disabled = true;
      try {
        await loadDataFromAPI();
        renderRankingList();
        renderEditableTable();
        updateOverallRate();
        updateCharts();
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        const now = new Date();
        const timeString = now.toLocaleString('zh-CN', { 
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        });
        document.getElementById('lastUpdateTime').textContent = timeString;
        showMessage('æ•°æ®å·²åˆ·æ–°', 'success');
      } catch (e) {
        console.error('åˆ·æ–°è¿œç¨‹æ•°æ®å¤±è´¥:', e);
        showMessage('åˆ·æ–°å¤±è´¥ï¼Œå·²ä¿ç•™æœ¬åœ°æ•°æ®', 'error');
      } finally {
        refreshBtn.classList.remove('animate-spin');
        refreshBtn.disabled = false;
      }
    }

    // å¯¼å‡ºæ‰€æœ‰æ•°æ®
    function exportAllData() {
      const exportData = {
        version: '1.0',
        exportTime: new Date().toISOString(),
        teamData: teamData,
        trendData: {
          dates: trendDates,
          teamData: trendData
        },
        announcements: announcements,
        awards: awards,
        systemSettings: JSON.parse(localStorage.getItem('systemSettings') || '{}')
      };
      
      // åˆ›å»ºä¸‹è½½é“¾æ¥
      const dataStr = JSON.stringify(exportData, null, 2);
      const dataBlob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(dataBlob);
      
      const link = document.createElement('a');
      link.href = url;
      const timestamp = new Date().toISOString().replace(/[:.]/g, '-').slice(0, -5);
      link.download = `æ’è¡Œæ¦œæ•°æ®_${timestamp}.json`;
      
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
      
      showMessage('æ•°æ®å¯¼å‡ºæˆåŠŸï¼æ–‡ä»¶å·²ä¸‹è½½', 'success');
    }

    // å¯¼å…¥æ•°æ®
    function importAllData(event) {
      const file = event.target.files[0];
      if (!file) return;
      
      // éªŒè¯æ–‡ä»¶ç±»å‹
      if (!file.name.endsWith('.json')) {
        showMessage('è¯·é€‰æ‹©æœ‰æ•ˆçš„JSONæ–‡ä»¶', 'error');
        event.target.value = '';
        return;
      }
      
      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const importData = JSON.parse(e.target.result);
          
          // éªŒè¯æ•°æ®æ ¼å¼
          if (!importData.version || !importData.teamData) {
            showMessage('æ–‡ä»¶æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·é€‰æ‹©æœ‰æ•ˆçš„å¯¼å‡ºæ–‡ä»¶', 'error');
            return;
          }
          
          // ç¡®è®¤å¯¼å…¥
          if (!confirm('å¯¼å…¥æ•°æ®å°†è¦†ç›–å½“å‰æ‰€æœ‰æœ¬åœ°æ•°æ®ï¼Œæ˜¯å¦ç»§ç»­ï¼Ÿ\n\nå»ºè®®å…ˆå¯¼å‡ºå½“å‰æ•°æ®è¿›è¡Œå¤‡ä»½ï¼')) {
            event.target.value = '';
            return;
          }
          
          // å¯¼å…¥å›¢é˜Ÿæ•°æ®
          if (importData.teamData) {
            teamData = importData.teamData;
            localStorage.setItem('teamData', JSON.stringify(teamData));
          }
          
          // å¯¼å…¥è¶‹åŠ¿æ•°æ®
          if (importData.trendData) {
            trendDates = importData.trendData.dates || getDefaultTrendDates();
            trendData = importData.trendData.teamData || {};
            saveTrendData();
          }
          
          // å¯¼å…¥å…¬å‘Šæ•°æ®
          if (importData.announcements) {
            announcements = importData.announcements;
            saveAnnouncements();
          }
          
          // å¯¼å…¥å¥–é¡¹æ•°æ®
          if (importData.awards) {
            awards = importData.awards;
            // ä¿å­˜å¥–é¡¹æ•°æ®ï¼ˆéœ€è¦åŒ…å«blockTitleï¼‰
            const savedData = localStorage.getItem('awards');
            let blockTitle = DEFAULT_AWARD_TITLE;
            if (savedData) {
              try {
                blockTitle = JSON.parse(savedData).blockTitle || DEFAULT_AWARD_TITLE;
              } catch(e) {}
            }
            const awardsData = {
              blockTitle: blockTitle,
              awards: awards
            };
            localStorage.setItem('awards', JSON.stringify(awardsData));
          }
          
          // å¯¼å…¥ç³»ç»Ÿè®¾ç½®
          if (importData.systemSettings) {
            localStorage.setItem('systemSettings', JSON.stringify(importData.systemSettings));
          }
          
          // é‡æ–°åŠ è½½æ‰€æœ‰æ•°æ®
          loadTeamData();
          loadTrendData();
          loadAnnouncements();
          loadAwards();
          loadSystemSettings();
          
          // é‡æ–°æ¸²æŸ“ç•Œé¢
          renderRankingList();
          renderEditableTable();
          renderTrendDates();
          renderTrendDataTable();
          renderAnnouncements();
          renderAnnouncementHistory();
          renderAwardsList();
          renderBestTeams();
          updateOverallRate();
          updateCharts();
          updateTrendChart('top3');
          startCountdown();
          
          showMessage('æ•°æ®å¯¼å…¥æˆåŠŸï¼é¡µé¢å·²æ›´æ–°', 'success');
          
          // æ¸…ç©ºæ–‡ä»¶è¾“å…¥
          event.target.value = '';
          
        } catch (error) {
          console.error('å¯¼å…¥é”™è¯¯:', error);
          showMessage('æ•°æ®å¯¼å…¥å¤±è´¥ï¼Œæ–‡ä»¶æ ¼å¼é”™è¯¯', 'error');
          event.target.value = '';
        }
      };
      
      reader.onerror = function() {
        showMessage('æ–‡ä»¶è¯»å–å¤±è´¥', 'error');
        event.target.value = '';
      };
      
      reader.readAsText(file);
    }

    // æ¸…ç©ºæ‰€æœ‰æ•°æ®
    function clearAllData() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰æœ¬åœ°æ•°æ®å—ï¼Ÿ\n\næ­¤æ“ä½œå°†åˆ é™¤ï¼š\n- æ‰€æœ‰å›¢é˜Ÿæ•°æ®\n- è¶‹åŠ¿æ•°æ®\n- å…¬å‘Šä¿¡æ¯\n- å¥–é¡¹è®¾ç½®\n- ç³»ç»Ÿè®¾ç½®\n\næ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        return;
      }
      
      if (!confirm('å†æ¬¡ç¡®è®¤ï¼šçœŸçš„è¦æ¸…ç©ºæ‰€æœ‰æ•°æ®å—ï¼Ÿ')) {
        return;
      }
      
      // æ¸…ç©º localStorage
      localStorage.clear();
      
      // é‡ç½®ä¸ºé»˜è®¤æ•°æ®
      teamData = [...defaultTeamData];
      announcements = [];
      awards = [];
      trendDates = getDefaultTrendDates();
      initializeTrendData();
      
      // ä¿å­˜é»˜è®¤æ•°æ®
      saveTeamData();
      saveTrendData();
      saveAnnouncements();
      saveAwards();
      
      // é‡æ–°åŠ è½½å’Œæ¸²æŸ“
      loadSystemSettings();
      renderRankingList();
      renderEditableTable();
      renderTrendDates();
      renderTrendDataTable();
      renderAnnouncements();
      renderAnnouncementHistory();
      renderAwardsList();
      renderBestTeams();
      updateOverallRate();
      updateCharts();
      updateTrendChart('top3');
      startCountdown();
      
      showMessage('æ‰€æœ‰æ•°æ®å·²æ¸…ç©ºï¼Œæ¢å¤åˆ°åˆå§‹çŠ¶æ€', 'success');
    }

    // è®¾ç½®äº‹ä»¶ç›‘å¬å™¨
    function setupEventListeners() {
      if (isEventListenersSetup) return;
      isEventListenersSetup = true;
      
      // è¾…åŠ©å‡½æ•°ï¼šå®‰å…¨åœ°æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
      const safeAddEventListener = (elementId, event, handler) => {
        const element = document.getElementById(elementId);
        if (element) {
          element.addEventListener(event, handler);
          return true;
        } else {
          console.warn(`âš  å…ƒç´ ä¸å­˜åœ¨: ${elementId}`);
          return false;
        }
      };
      
      console.log('è®¾ç½®äº‹ä»¶ç›‘å¬å™¨...');
      
      // ç®¡ç†é¢æ¿åˆ‡æ¢
      safeAddEventListener('adminToggle', 'click', () => {
        const panel = document.getElementById('adminPanel');
        panel.classList.toggle('hidden');
        if (!panel.classList.contains('hidden')) {
          renderEditableTable();
          // å¹³æ»‘æ»šåŠ¨åˆ°ç®¡ç†é¢æ¿
          setTimeout(() => {
            panel.scrollIntoView({ behavior: 'smooth', block: 'start' });
          }, 100);
        }
      });
      
      safeAddEventListener('closeAdminPanel', 'click', () => {
        document.getElementById('adminPanel').classList.add('hidden');
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
      
      // åˆ·æ–°æŒ‰é’®
      safeAddEventListener('refreshBtn', 'click', refreshData);
      
      // å¿«é€Ÿæ·»åŠ å›¢é˜Ÿ
      safeAddEventListener('quickAddTeamBtn', 'click', () => {
        const name = document.getElementById('quickTeamName').value.trim();
        const channel = document.getElementById('quickTeamChannel').value;
        const rate = document.getElementById('quickTeamRate').value;
        
        if (!name) {
          showMessage('è¯·è¾“å…¥å›¢é˜Ÿåç§°', 'error');
          document.getElementById('quickTeamName').focus();
          return;
        }
        
        if (!rate || parseFloat(rate) < 0) {
          showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„è¾¾æˆç‡', 'error');
          document.getElementById('quickTeamRate').focus();
          return;
        }
        
        addNewTeam(name, channel, rate);
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        document.getElementById('quickTeamName').value = '';
        document.getElementById('quickTeamRate').value = '';
        document.getElementById('quickTeamName').focus();
      });
      
      // æ”¯æŒEnteré”®æäº¤
      safeAddEventListener('quickTeamRate', 'keypress', (e) => {
        if (e.key === 'Enter') {
          document.getElementById('quickAddTeamBtn').click();
        }
      });
      
      // æ·»åŠ æ–°è¡ŒæŒ‰é’®
      safeAddEventListener('addRowBtn', 'click', () => {
        addNewTeam(`æ–°å›¢é˜Ÿ${teamData.length + 1}`, 'ç›´æ’­éƒ¨', 0);
      });
      
      // ä¿å­˜æ•°æ®æŒ‰é’®
      safeAddEventListener('saveDataBtn', 'click', () => {
        saveTeamData();
        renderRankingList();
        updateCharts();
        showMessage('æ‰€æœ‰æ›´æ”¹å·²ä¿å­˜', 'success');
      });
      
      // é‡ç½®ç»“æŸæ—¶é—´æŒ‰é’®
      safeAddEventListener('resetEndTimeBtn', 'click', () => {
        document.getElementById('activityEndTime').value = formatDateTimeLocal(DEFAULT_END_TIME);
        showMessage('å·²é‡ç½®ä¸ºé»˜è®¤æ—¶é—´', 'info');
      });
      
      // å…¬å‘Šè¾“å…¥æ¡†å­—ç¬¦è®¡æ•°
      safeAddEventListener('announcementInput', 'input', updateCharCount);
      
      // å…¬å‘Šè¾“å…¥æ¡†æ”¯æŒCtrl+Enterå¿«æ·å‘å¸ƒ
      safeAddEventListener('announcementInput', 'keydown', (e) => {
        if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
          e.preventDefault();
          publishAnnouncement();
        }
      });
      
      // å‘å¸ƒå…¬å‘ŠæŒ‰é’®
      safeAddEventListener('publishAnnouncementBtn', 'click', publishAnnouncement);
      
      // æ¸…é™¤å†å²å…¬å‘ŠæŒ‰é’®
      safeAddEventListener('clearAnnouncementsBtn', 'click', clearAllAnnouncements);
      
      // æ·»åŠ å¥–é¡¹æŒ‰é’®
      safeAddEventListener('addAwardBtn', 'click', addNewAward);
      
      // ä¿å­˜å¥–é¡¹è®¾ç½®æŒ‰é’®
      safeAddEventListener('saveAwardsBtn', 'click', saveAwardsSettings);
      
      // é‡ç½®å¥–é¡¹æŒ‰é’®
      safeAddEventListener('resetAwardsBtn', 'click', resetAwardsSettings);
      
      // è¶‹åŠ¿æ•°æ®ç¼–è¾‘ç›¸å…³
      safeAddEventListener('addTrendDateBtn', 'click', addTrendDate);
      safeAddEventListener('resetTrendDatesBtn', 'click', resetTrendDates);
      safeAddEventListener('saveTrendDataBtn', 'click', saveTrendDataAndUpdateChart);
      safeAddEventListener('autoGenerateTrendBtn', 'click', autoGenerateTrendData);
      
      // æ•°æ®å¯¼å…¥å¯¼å‡ºç›¸å…³
      safeAddEventListener('exportDataBtn', 'click', exportAllData);
      safeAddEventListener('importDataBtn', 'click', () => {
        document.getElementById('importDataInput').click();
      });
      safeAddEventListener('importDataInput', 'change', importAllData);
      safeAddEventListener('clearAllDataBtn', 'click', clearAllData);
      
      // ä¿å­˜è®¾ç½®æŒ‰é’®
      safeAddEventListener('saveSettingsBtn', 'click', () => {
        const refreshInterval = document.getElementById('refreshInterval').value;
        const dataSource = document.getElementById('dataSource').value;
        const rankingCount = document.getElementById('rankingCount').value;
        const enableAnimation = document.getElementById('enableAnimation').checked;
        const enableNotification = document.getElementById('enableNotification').checked;
        const activityEndTime = document.getElementById('activityEndTime').value;
        
        // éªŒè¯ç»“æŸæ—¶é—´
        if (!activityEndTime) {
          showMessage('è¯·è®¾ç½®æ´»åŠ¨ç»“æŸæ—¶é—´', 'error');
          document.getElementById('activityEndTime').focus();
          return;
        }
        
        const endDate = new Date(activityEndTime);
        const now = new Date();
        if (endDate < now) {
          if (!confirm('è®¾ç½®çš„ç»“æŸæ—¶é—´æ—©äºå½“å‰æ—¶é—´ï¼Œæ´»åŠ¨å°†æ˜¾ç¤ºä¸ºå·²ç»“æŸã€‚æ˜¯å¦ç»§ç»­ä¿å­˜ï¼Ÿ')) {
            return;
          }
        }
        
        const settings = {
          refreshInterval,
          dataSource,
          rankingCount,
          enableAnimation,
          enableNotification,
          activityEndTime
        };
        
        localStorage.setItem('systemSettings', JSON.stringify(settings));
        
        // ç¦ç”¨è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
        // åº”ç”¨è®¾ç½®
        // if (refreshInterval && refreshInterval >= 10) {
        //   clearInterval(autoRefreshTimer);
        //   autoRefreshTimer = setInterval(refreshData, refreshInterval * 1000);
        // }
        console.log('è‡ªåŠ¨åˆ·æ–°å·²ç¦ç”¨ï¼Œè®¾ç½®å·²ä¿å­˜');
        
        // é‡å¯å€’è®¡æ—¶
        startCountdown();
        
        showMessage('è®¾ç½®å·²ä¿å­˜ï¼ˆè‡ªåŠ¨åˆ·æ–°å·²ç¦ç”¨ï¼‰', 'success');
      });
      
      // æ—¶é—´èŒƒå›´é€‰æ‹©ï¼ˆå¯é€‰å…ƒç´ ï¼‰
      if (safeAddEventListener('timeRange', 'change', (e) => {
        const range = e.target.value;
        const rangeText = e.target.options[e.target.selectedIndex].text;
        showMessage(`å·²åˆ‡æ¢åˆ°${rangeText}`, 'info');
        refreshData();
      })) {
        console.log('  âœ“ æ—¶é—´èŒƒå›´é€‰æ‹©å™¨å·²ç»‘å®š');
      }
      
      // ä¸»é¢˜åˆ‡æ¢
      safeAddEventListener('themeToggle', 'click', () => {
        document.body.classList.toggle('dark');
        const isDark = document.body.classList.contains('dark');
        const icon = document.querySelector('#themeToggle i');
        icon.className = isDark ? 'fa fa-sun-o' : 'fa fa-moon-o';
        showMessage(isDark ? 'å·²åˆ‡æ¢åˆ°æ·±è‰²æ¨¡å¼' : 'å·²åˆ‡æ¢åˆ°æµ…è‰²æ¨¡å¼', 'info');
      });
      
      // æ’åç­›é€‰æŒ‰é’®
      document.querySelectorAll('.ranking-filter').forEach(btn => {
        btn.addEventListener('click', function() {
          // ç§»é™¤æ‰€æœ‰æŒ‰é’®çš„æ¿€æ´»çŠ¶æ€
          document.querySelectorAll('.ranking-filter').forEach(b => {
            b.className = 'ranking-filter btn-secondary text-xs sm:text-sm flex-1 sm:flex-none';
          });
          
          // æ¿€æ´»å½“å‰æŒ‰é’®
          this.className = 'ranking-filter btn-primary text-xs sm:text-sm flex-1 sm:flex-none';
          
          const filterType = this.textContent.trim();
          showMessage(`å·²æŒ‰${filterType}æ’åº`, 'info');
          
          // è¿™é‡Œå¯ä»¥æ ¹æ®ä¸åŒçš„ç­›é€‰æ¡ä»¶é‡æ–°æ’åº
          // ä¾‹å¦‚ï¼šæŒ‰ç¯æ¯”å¢é•¿æ’åº
          if (filterType === 'ç¯æ¯”å¢é•¿') {
            teamData.sort((a, b) => b.rankChange - a.rankChange);
            renderRankingList();
          } else if (filterType === 'è¾¾æˆç‡') {
            teamData.sort((a, b) => b.rate - a.rate);
            renderRankingList();
          }
        });
      });
      
      // å›¢é˜Ÿå¯¹æ¯”é€‰æ‹©
      safeAddEventListener('teamComparison', 'change', (e) => {
        const comparison = e.target.value;
        updateTrendChart(comparison);
      });
      
      console.log('âœ“ äº‹ä»¶ç›‘å¬å™¨è®¾ç½®å®Œæˆ');
    }

    // æ›´æ–°è¶‹åŠ¿å›¾
    function updateTrendChart(comparison) {
      if (!charts.trend) return;
      
      let datasets = [];
      
      if (comparison === 'top3') {
        const top3 = [...teamData].sort((a, b) => b.rate - a.rate).slice(0, 3);
        datasets = top3.map((team, index) => {
          const data = trendData[team.id] || generateTrendDataForTeam(team.rate);
          return {
            label: team.name,
            data: data,
            borderColor: ['#FF4D4F', '#FAAD14', '#52C41A'][index],
            backgroundColor: [
              'rgba(255, 77, 79, 0.1)',
              'rgba(250, 173, 20, 0.1)',
              'rgba(82, 196, 26, 0.1)'
            ][index],
            tension: 0.4,
            borderWidth: 2,
            pointRadius: 4,
            pointHoverRadius: 6
          };
        });
      } else if (comparison === 'all') {
        // è®¡ç®—æ‰€æœ‰å›¢é˜Ÿçš„å¹³å‡å€¼
        const avgData = [];
        for (let i = 0; i < trendDates.length; i++) {
          let sum = 0;
          let count = 0;
          teamData.forEach(team => {
            if (trendData[team.id] && trendData[team.id][i] !== undefined) {
              sum += trendData[team.id][i];
              count++;
            }
          });
          avgData.push(count > 0 ? Math.round(sum / count * 100) / 100 : 0);
        }
        
        datasets = [{
          label: 'æ‰€æœ‰å›¢é˜Ÿå¹³å‡',
          data: avgData,
          borderColor: '#1890FF',
          backgroundColor: 'rgba(24, 144, 255, 0.1)',
          tension: 0.4,
          borderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6
        }];
      }
      
      charts.trend.data.labels = trendDates;
      charts.trend.data.datasets = datasets;
      charts.trend.update('active');
    }

    // è‡ªåŠ¨ä¿å­˜
    function enableAutoSave() {
      setInterval(() => {
        saveTeamData();
      }, 30000); // æ¯30ç§’è‡ªåŠ¨ä¿å­˜ä¸€æ¬¡
    }

    // æ ¼å¼åŒ–æ—¥æœŸæ—¶é—´ä¸º datetime-local è¾“å…¥æ¡†æ ¼å¼
    function formatDateTimeLocal(dateTimeStr) {
      const date = new Date(dateTimeStr);
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, '0');
      const day = String(date.getDate()).padStart(2, '0');
      const hours = String(date.getHours()).padStart(2, '0');
      const minutes = String(date.getMinutes()).padStart(2, '0');
      return `${year}-${month}-${day}T${hours}:${minutes}`;
    }

    // åŠ è½½ç³»ç»Ÿè®¾ç½®
    function loadSystemSettings() {
      const savedSettings = localStorage.getItem('systemSettings');
      if (savedSettings) {
        const settings = JSON.parse(savedSettings);
        
        if (settings.refreshInterval) {
          document.getElementById('refreshInterval').value = settings.refreshInterval;
          // ç¦ç”¨è‡ªåŠ¨åˆ·æ–°åŠŸèƒ½
          // autoRefreshTimer = setInterval(refreshData, settings.refreshInterval * 1000);
          console.log('è‡ªåŠ¨åˆ·æ–°å·²ç¦ç”¨ï¼Œåˆ·æ–°é—´éš”è®¾ç½®:', settings.refreshInterval);
        }
        
        if (settings.dataSource) {
          document.getElementById('dataSource').value = settings.dataSource;
        }
        
        if (settings.rankingCount) {
          document.getElementById('rankingCount').value = settings.rankingCount;
        }
        
        if (settings.enableAnimation !== undefined) {
          document.getElementById('enableAnimation').checked = settings.enableAnimation;
        }
        
        if (settings.enableNotification !== undefined) {
          document.getElementById('enableNotification').checked = settings.enableNotification;
        }
        
        // åŠ è½½æ´»åŠ¨ç»“æŸæ—¶é—´
        const endTime = settings.activityEndTime || DEFAULT_END_TIME;
        document.getElementById('activityEndTime').value = formatDateTimeLocal(endTime);
      } else {
        // é¦–æ¬¡åŠ è½½ï¼Œè®¾ç½®é»˜è®¤å€¼
        document.getElementById('activityEndTime').value = formatDateTimeLocal(DEFAULT_END_TIME);
      }
    }

    // é”®ç›˜å¿«æ·é”®
    function setupKeyboardShortcuts() {
      document.addEventListener('keydown', (e) => {
        // Ctrl/Cmd + S ä¿å­˜
        if ((e.ctrlKey || e.metaKey) && e.key === 's') {
          e.preventDefault();
          saveTeamData();
          showMessage('æ•°æ®å·²ä¿å­˜', 'success');
        }
        
        // Ctrl/Cmd + R åˆ·æ–°
        if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
          e.preventDefault();
          refreshData();
        }
        
        // Esc å…³é—­ç®¡ç†é¢æ¿
        if (e.key === 'Escape') {
          const panel = document.getElementById('adminPanel');
          if (!panel.classList.contains('hidden')) {
            panel.classList.add('hidden');
          }
        }
      });
    }

    // å“åº”å¼å¤„ç†
    function handleResponsive() {
      const isMobile = window.innerWidth < 768;
      
      if (isMobile) {
        // ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼šå‡å°‘åŠ¨ç”»æ•ˆæœ
        document.querySelectorAll('.card-hover').forEach(card => {
          card.style.transition = 'background-color 0.2s';
        });
      } else {
        // æ¡Œé¢ç«¯æ¢å¤åŠ¨ç”»
        document.querySelectorAll('.card-hover').forEach(card => {
          card.style.transition = '';
        });
      }
    }

    // é”™è¯¯å¤„ç†
    window.addEventListener('error', function(event) {
      console.error('å…¨å±€é”™è¯¯:', event.error);
      showMessage('ç³»ç»Ÿå‡ºç°é”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•', 'error');
    });

    // é¡µé¢å¸è½½å‰ä¿å­˜æ•°æ®
    window.addEventListener('beforeunload', function(e) {
      saveTeamData();
    });

    // ç›‘å¬çª—å£å¤§å°å˜åŒ–
    let resizeTimer;
    window.addEventListener('resize', function() {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(() => {
        handleResponsive();
        // é‡ç»˜å›¾è¡¨ä»¥é€‚åº”æ–°å°ºå¯¸
        Object.values(charts).forEach(chart => {
          if (chart) chart.resize();
        });
      }, 250);
    });

    // é¡µé¢å¯è§æ€§å˜åŒ–å¤„ç†
    document.addEventListener('visibilitychange', function() {
      // ç¦ç”¨é¡µé¢åˆ‡æ¢è‡ªåŠ¨åˆ·æ–°
      // if (!document.hidden) {
      //   // é¡µé¢é‡æ–°å¯è§æ—¶åˆ·æ–°æ•°æ®
      //   refreshData();
      // }
      console.log('é¡µé¢å¯è§æ€§å˜åŒ–ï¼Œè‡ªåŠ¨åˆ·æ–°å·²ç¦ç”¨');
    });

    // æ·»åŠ è§¦æ‘¸åé¦ˆï¼ˆç§»åŠ¨ç«¯ï¼‰
    function setupTouchFeedback() {
      if ('ontouchstart' in window) {
        document.querySelectorAll('.rank-item, .card-hover').forEach(element => {
          element.addEventListener('touchstart', function() {
            this.style.transform = 'scale(0.98)';
          });
          
          element.addEventListener('touchend', function() {
            this.style.transform = '';
          });
        });
      }
    }

    // åˆå§‹åŒ–å‡½æ•° - å¢å¼ºé”™è¯¯è¯Šæ–­
    async function init() {
      try {
        console.log('========================================');
        console.log('ç³»ç»Ÿåˆå§‹åŒ–å¼€å§‹ - ' + new Date().toLocaleString());
        console.log('========================================');
        
        // æ­¥éª¤1: æ£€æŸ¥DOMå…ƒç´ 
        console.log('[1/10] æ£€æŸ¥å…³é”®DOMå…ƒç´ ...');
        const criticalElements = [
          'rankingList', 'topThreeContainer', 'editableTeamTable',
          'announcementContainer', 'bestTeamsContainer', 'trendChart',
          'achievementChart', 'lastUpdateTime', 'refreshBtn'
        ];
        
        const missingElements = [];
        criticalElements.forEach(id => {
          const el = document.getElementById(id);
          if (!el) {
            missingElements.push(id);
            console.error(`  âœ— ç¼ºå¤±å…ƒç´ : ${id}`);
          } else {
            console.log(`  âœ“ æ‰¾åˆ°å…ƒç´ : ${id}`);
          }
        });
        
        if (missingElements.length > 0) {
          throw new Error(`ç¼ºå¤±å…³é”®DOMå…ƒç´ : ${missingElements.join(', ')}`);
        }
        
        // æ­¥éª¤2: åŠ è½½æœ¬åœ°æ•°æ®
        console.log('[2/10] åŠ è½½å›¢é˜Ÿæ•°æ®...');
        loadTeamData();
        console.log(`  âœ“ åŠ è½½äº† ${teamData.length} ä¸ªå›¢é˜Ÿ`);
        
        console.log('[3/10] åŠ è½½ç³»ç»Ÿè®¾ç½®...');
        loadSystemSettings();
        console.log('  âœ“ ç³»ç»Ÿè®¾ç½®å·²åŠ è½½');
        
        // æ­¥éª¤3: åŠ è½½è¿œç¨‹æ•°æ®ï¼ˆå¯é€‰ï¼‰
        console.log('[4/10] å°è¯•åŠ è½½è¿œç¨‹æ•°æ®...');
        try {
          await loadDataFromAPI();
          console.log('  âœ“ è¿œç¨‹æ•°æ®åŠ è½½æˆåŠŸ');
        } catch (err) {
          console.warn('  âš  è¿œç¨‹æ•°æ®åŠ è½½å¤±è´¥ï¼Œä½¿ç”¨æœ¬åœ°æ•°æ®:', err.message);
        }
        
        console.log('[5/10] åŠ è½½å…¬å‘Šæ•°æ®...');
        loadAnnouncements();
        console.log(`  âœ“ åŠ è½½äº† ${announcements.length} æ¡å…¬å‘Š`);
        
        console.log('[6/10] åŠ è½½å¥–é¡¹æ•°æ®...');
        loadAwards();
        console.log(`  âœ“ åŠ è½½äº† ${awards.length} ä¸ªå¥–é¡¹`);
        
        console.log('[7/10] åŠ è½½è¶‹åŠ¿æ•°æ®...');
        loadTrendData();
        console.log(`  âœ“ åŠ è½½äº† ${trendDates.length} ä¸ªæ—¥æœŸèŠ‚ç‚¹`);
        
        // æ­¥éª¤4: æ¸²æŸ“ç•Œé¢
        console.log('[8/10] æ¸²æŸ“ç•Œé¢ç»„ä»¶...');
        renderRankingList();
        console.log('  âœ“ æ’è¡Œæ¦œåˆ—è¡¨å·²æ¸²æŸ“');
        
        renderEditableTable();
        console.log('  âœ“ ç¼–è¾‘è¡¨æ ¼å·²æ¸²æŸ“');
        
        renderAnnouncements();
        console.log('  âœ“ å…¬å‘Šåˆ—è¡¨å·²æ¸²æŸ“');
        
        renderAnnouncementHistory();
        console.log('  âœ“ å…¬å‘Šå†å²å·²æ¸²æŸ“');
        
        renderAwardsList();
        console.log('  âœ“ å¥–é¡¹åˆ—è¡¨å·²æ¸²æŸ“');
        
        renderBestTeams();
        console.log('  âœ“ æœ€ä½³å›¢é˜Ÿå·²æ¸²æŸ“');
        
        renderTrendDates();
        console.log('  âœ“ è¶‹åŠ¿æ—¥æœŸå·²æ¸²æŸ“');
        
        renderTrendDataTable();
        console.log('  âœ“ è¶‹åŠ¿æ•°æ®è¡¨å·²æ¸²æŸ“');
        
        // æ­¥éª¤5: åˆå§‹åŒ–åŠŸèƒ½
        console.log('[9/10] åˆå§‹åŒ–åŠŸèƒ½æ¨¡å—...');
        
        initCharts();
        console.log('  âœ“ å›¾è¡¨å·²åˆå§‹åŒ–');
        
        startCountdown();
        console.log('  âœ“ å€’è®¡æ—¶å·²å¯åŠ¨');
        
        setupEventListeners();
        console.log('  âœ“ äº‹ä»¶ç›‘å¬å™¨å·²è®¾ç½®');
        
        setupKeyboardShortcuts();
        console.log('  âœ“ é”®ç›˜å¿«æ·é”®å·²è®¾ç½®');
        
        setupTouchFeedback();
        console.log('  âœ“ è§¦æ‘¸åé¦ˆå·²è®¾ç½®');
        
        // æ­¥éª¤6: æ›´æ–°æ˜¾ç¤º
        console.log('[10/10] æ›´æ–°æ•°æ®æ˜¾ç¤º...');
        updateOverallRate();
        console.log('  âœ“ æ€»ä½“è¾¾æˆç‡å·²æ›´æ–°');
        
        updateCharts();
        console.log('  âœ“ å›¾è¡¨æ•°æ®å·²æ›´æ–°');
        
        handleResponsive();
        console.log('  âœ“ å“åº”å¼å¤„ç†å®Œæˆ');
        
        // å¯ç”¨è‡ªåŠ¨ä¿å­˜ï¼ˆä½†ä¸å¯ç”¨è‡ªåŠ¨åˆ·æ–°ï¼‰
        enableAutoSave();
        console.log('  âœ“ è‡ªåŠ¨ä¿å­˜å·²å¯ç”¨ï¼ˆ30ç§’é—´éš”ï¼‰');
        console.log('  âš  è‡ªåŠ¨åˆ·æ–°å·²ç¦ç”¨ï¼Œä»…ä¿ç•™æ‰‹åŠ¨åˆ·æ–°åŠŸèƒ½');
        
        // æ›´æ–°æœ€åæ›´æ–°æ—¶é—´
        const now = new Date();
        const timeString = now.toLocaleString('zh-CN', { 
          year: 'numeric',
          month: '2-digit',
          day: '2-digit',
          hour: '2-digit',
          minute: '2-digit',
          second: '2-digit',
          hour12: false
        });
        document.getElementById('lastUpdateTime').textContent = timeString;
        
        // æ˜¾ç¤ºåŠ è½½æˆåŠŸ
        setTimeout(() => {
          showMessage('ç³»ç»ŸåŠ è½½å®Œæˆï¼ˆè‡ªåŠ¨åˆ·æ–°å·²ç¦ç”¨ï¼‰', 'success');
        }, 500);
        
        console.log('========================================');
        console.log('âœ“ ç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸå®Œæˆ');
        console.log('========================================');
        
      } catch (error) {
        console.error('========================================');
        console.error('âœ— åˆå§‹åŒ–å¤±è´¥è¯¦æƒ…:');
        console.error('é”™è¯¯ç±»å‹:', error.name);
        console.error('é”™è¯¯æ¶ˆæ¯:', error.message);
        console.error('é”™è¯¯å †æ ˆ:', error.stack);
        console.error('========================================');
        
        // æ˜¾ç¤ºå‹å¥½çš„é”™è¯¯ä¿¡æ¯
        const errorMsg = `
ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥ï¼

é”™è¯¯ç±»å‹: ${error.name}
é”™è¯¯ä¿¡æ¯: ${error.message}

è¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨æ§åˆ¶å°æŸ¥çœ‹è¯¦ç»†é”™è¯¯
2. æ¸…é™¤æµè§ˆå™¨ç¼“å­˜å’ŒlocalStorage
3. ç¡®ä¿ç½‘ç»œè¿æ¥æ­£å¸¸
4. å°è¯•åˆ·æ–°é¡µé¢
        `;
        
        alert(errorMsg);
        showMessage('ç³»ç»Ÿåˆå§‹åŒ–å¤±è´¥: ' + error.message, 'error');
      }
    }

    // DOM åŠ è½½å®Œæˆååˆå§‹åŒ–
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }

    // å¯¼å‡ºä¸€äº›å…¨å±€æ–¹æ³•ä¾›è°ƒè¯•ä½¿ç”¨
    window.debugApp = {
      teamData: () => teamData,
      charts: () => charts,
      refresh: refreshData,
      addTeam: addNewTeam,
      deleteTeam: deleteTeam,
      saveData: saveTeamData,
      loadData: loadTeamData
    };
  </script>
</body>
</html>
